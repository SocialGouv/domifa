<div class="login-page" *ngIf="!usagerProfile">
  <section class="row fr-background-alt--grey login-page_form-section m-0">
    <div class="col-12 col-md-6 col-sm-6 form-container">
      <form
        class="column d-flex form-container_form-element"
        [formGroup]="loginForm"
        (ngSubmit)="login()"
      >
        <h3 class="align-self-start">Connexion à Mon Domifa</h3>
        <h5 class="align-self-start">Se connecter avec son compte</h5>
        <span class="col-12 col-md-12"> * champs obligatoires </span>
        <dsfr-form-input
          appUppercase
          inputId="login"
          type="email"
          formControlName="login"
          autocomplete="username"
          [ariaInvalid]="f.login.dirty && f.login.errors ? 'true' : 'false'"
          [ariaDescription]="
            f.login.dirty && f.login.errors ? 'invalid-login' : null
          "
          [disabled]="this.mode === 'login-change-password'"
          [message]="
            f.login.dirty && f.login.errors
              ? 'Veuillez vérifier l\'identifiant. Celui-ci se trouve sur le document que vous à remit la structure.'
              : ''
          "
          [messageSeverity]="
            f.login.dirty && f.login.errors ? 'error' : 'valid'
          "
          [required]="true"
          [customClass]="'required'"
          label="identifiant *"
        ></dsfr-form-input>
        <ng-container *ngIf="this.mode === 'login-change-password'">
          <p>
            C'est votre première connexion, veuillez choisir un nouveau mot de
            passe:
          </p>
          <dsfr-form-password
            inputId="newPassword"
            autocomplete="newPassword"
            formControlName="newPassword"
            label="Nouveau mot de passe *"
            class="required"
            [required]="true"
            [ariaDescription]="
              f.newPassword.dirty && f.newPassword.errors ? true : false
            "
            [validationRules]="
              f.newPassword.dirty
                ? [
                    {
                      message: 'Au moins 1 chiffre',
                      onError:
                        f.newPassword.errors?.hasNumber ||
                        f.newPassword.errors?.required ||
                        false
                    },
                    {
                      message: ' Au moins une lettre en majuscule',
                      onError:
                        f.newPassword.errors?.hasCapitalCase ||
                        f.newPassword.errors?.required ||
                        false
                    },
                    {
                      message: 'Au moins une lettre en minuscule',
                      onError:
                        f.newPassword.errors?.hasLowerCase ||
                        f.newPassword.errors?.required ||
                        false
                    },
                    {
                      message:
                        'Au moins un caractère spécial: @[]^_!#$%&\'()*+,\-./:;{}<>=|~?',
                      onError:
                        f.newPassword.errors?.hasSpecialCharacter ||
                        f.newPassword.errors?.required ||
                        false
                    },
                    {
                      message: 'entre 12 et 150 caractères',
                      onError:
                        f.newPassword.errors?.required ||
                        f.newPassword.errors?.minlength ||
                        f.newPassword.errors?.maxlength ||
                        false
                    }
                  ]
                : []
            "
          ></dsfr-form-password>
          <dsfr-form-password
            class="required"
            inputId="newPasswordConfirm"
            autocomplete="newPasswordConfirm"
            formControlName="newPasswordConfirm"
            label="Confirmation du mot de passe *"
            [required]="true"
            [ariaDescription]="
              f.newPasswordConfirm.dirty && f.newPasswordConfirm.errors
                ? true
                : false
            "
            [validationRules]="
              f.newPasswordConfirm.dirty &&
              this.loginForm.hasError('new-password-confim-does-not-match')
                ? [
                    {
                      message:
                        'La confirmation doit correspondre au nouveau mot de passe',
                      onError:
                        this.loginForm.hasError(
                          'new-password-confim-does-not-match'
                        ) || false
                    }
                  ]
                : []
            "
          ></dsfr-form-password>
          <div
            [class.fr-checkbox-group--error]="f.acceptTerms.errors"
            class="fr-checkbox-group"
          >
            <input
              type="checkbox"
              formControlName="acceptTerms"
              name="acceptTerms"
              [attr.aria-describedby]="
                f.acceptTerms.errors ? 'invalid-cgu-choice' : null
              "
              id="acceptTerms"
              required
            />
            <label class="fr-label" for="acceptTerms"
              >Je confirme avoir lu et accepter les
              <a class="dsfr-link" routerLink="/cgu" target="_blank"
                >conditions générales d’utilisation</a
              ></label
            >
            <div aria-live="polite" class="fr-messages-group">
              <p
                [class.fr-message--error]="f.acceptTerms.errors"
                class="fr-message"
              >
                Vous devez accepter les CGU afin de poursuivre l'inscription
              </p>
            </div>
          </div>
        </ng-container>
        <div
          *ngIf="this.mode !== 'login-change-password'"
          class="flex flex-column gap-1"
        >
          <dsfr-form-password
            inputId="password"
            autocomplete="current-password"
            formControlName="password"
            [disabled]="false"
            label="Mot de passe *"
            [required]="true"
            [validationRules]="
              f.password.dirty &&
              f.password.errors &&
              f.password.errors.required
                ? [
                    {
                      message: 'Le mot de passe est obligatoire',
                      onError: true
                    }
                  ]
                : []
            "
          ></dsfr-form-password>
          <a
            (click)="showHint($event)"
            class="fr-link align-self-start"
            href="#"
          >
            Mot de passe oublié ?</a
          >
        </div>

        <p class="my-2" id="pwd-infos" *ngIf="displayPasswordIndication">
          Vous avez peut-être bloqué votre compte en faisant plus de 3
          tentatives de connexion avec un mauvais mot de passe.
          <br />
          <b>Veuillez réessayer dans une heure.</b>

          <br />
          <br />
          Vous souhaitez changer de mot de passe ?
          <br />
          <b
            >Rendez-vous dans votre centre de domiciliation et demandez à un
            agent un nouveau mot passe.</b
          >
        </p>

        <dsfr-button
          [label]="'Se connecter'"
          [type]="'submit'"
          [variant]="'primary'"
          [size]="'MD'"
          [icon]="undefined"
          [disabled]="loading"
          [buttonId]="''"
          [customClass]="'d-flex flex-column w-100'"
        ></dsfr-button>
      </form>
    </div>
    <div class="col-12 col-md-6 col-sm-6 content-container bg-white">
      <div class="row d-flex gap-1 align-self-stretch align-content-center">
        <div class="col-12 col-md-6 col-sm-6">
          <img
            class="img-fluid"
            src="assets/images/logo-dsfr.svg"
            alt="Logo Mon Domifa"
          />
        </div>
        <h5>Mon DomiFa facilite votre domiciliation</h5>
        <p class="content-container_text">
          Retrouvez toutes vos informations de domiciliation et vérifiez que
          vous avez du courrier.
        </p>
        <div class="col-12 col-md-12 col-sm-12 justify-content-center d-flex">
          <img
            class="img-fluid"
            src="assets/images/login/main-container.svg"
            alt="Illustration de
        boîte aux lettres"
          />
        </div>
      </div>
    </div>
  </section>
  <hr />
  <section class="row d-flex login-page_faq-section">
    <h2 class="fr-text-label--blue-ecume">Les questions fréquentes</h2>
    <div class="d-flex flex-column">
      <dsfr-accordion
        [expanded]="false"
        [heading]="'Qu’est-ce que Mon DomiFa ?'"
        [headingLevel]="'H2'"
        [headingAriaLabel]="'Qu’est-ce que Mon DomiFa ?'"
      >
        <p>
          Mon DomiFa est
          <b>un portail en ligne dédié aux personnes domiciliées</b>. <br />
          Il vous permet de savoir si vous avez du courrier dans la structure
          qui vous domicilie, à condition que celle-ci utilise l’outil DomiFa.
        </p>
      </dsfr-accordion>
      <dsfr-accordion
        [expanded]="false"
        [heading]="'Est-ce un service payant ?'"
        [headingLevel]="'H2'"
        [headingAriaLabel]="'Est-ce un service payant ?'"
      >
        <p>
          Non. L’accès à votre espace Mon DomiFa est entièrement gratuit, à
          condition que votre structure a activé votre compte.
        </p>
      </dsfr-accordion>
      <dsfr-accordion
        [expanded]="false"
        [heading]="'Comment me connecter à mon espace personnel ?'"
        [headingLevel]="'H2'"
        [headingAriaLabel]="'Comment me connecter à mon espace personnel ?'"
      >
        <p>
          Rendez-vous sur
          <a class="fr-link" href="/auth/login" target="_blank">
            mon-domifa.fabrique.social.gouv.fr/auth/login</a
          >
        </p>
        <ul>
          <li>
            Lors de votre <b>première connexion</b>, utilisez
            <b
              >l’identifiant et le mot de passe temporaire fourni par votre
              structure</b
            >.
          </li>
          <li>
            À la première connexion, il vous sera demandé de
            <b>créer un nouveau mot de passe personnel</b>, qui servira pour
            toutes vos connexions suivantes.
          </li>
        </ul>
      </dsfr-accordion>
      <dsfr-accordion
        [expanded]="false"
        [heading]="'Que faire si j’ai perdu mes identifiants ?'"
        [headingLevel]="'H2'"
        [headingAriaLabel]="'Que faire si j’ai perdu mes identifiants ?'"
      >
        <p>
          En cas de perte d’identifiant ou de mot de passe,
          <b>contactez directement votre structure de domiciliation</b>.
        </p>
        <div class="fr-notice fr-notice--warning">
          <div class="fr-container">
            <div class="fr-notice__body">
              <p>
                <span class="fr-notice__desc"
                  >Aucun identifiant ou mot de passe ne peut être envoyé par
                  internet.</span
                >
              </p>
            </div>
          </div>
        </div>
      </dsfr-accordion>
      <dsfr-accordion
        [expanded]="false"
        [heading]="
          'Puis-je faire une demande en ligne (renouvellement, Cerfa, etc.) ?'
        "
        [headingLevel]="'H2'"
        [headingAriaLabel]="
          'Puis-je faire une demande en ligne (renouvellement, Cerfa, etc.) ?'
        "
      >
        <p>
          Non. Mon DomiFa est aujourd’hui un
          <b>outil de consultation uniquement</b>. Pour toute demande
          (renouvellement, justificatif, Cerfa, etc.), vous devez
          <b>contacter directement votre structure de domiciliation</b>.
        </p>
      </dsfr-accordion>
    </div>
    <dsfr-button
      class="d-flex justify-content-center"
      [label]="'Consulter l\'aide en ligne'"
      [type]="'button'"
      [tooltipMessage]="'Consulter l\'aide en ligne'"
      [variant]="'secondary'"
      [size]="'LG'"
    ></dsfr-button>
  </section>
</div>
