<div class="login-page" *ngIf="!usagerProfile">
  <section class="row login-page_form-section m-0">
    <div class="col-12 col-md-6 col-sm-6 form-container">
      <form
        class="column d-flex form-container_form-element"
        [formGroup]="loginForm"
        (ngSubmit)="login()"
      >
        <h3>Connexion à Mon Domifa</h3>
        <h5>Se connection avec son compte</h5>
        <!-- Use utility class -->
        <span style="color: red" class="col-12 col-md-12">
          * champs obligatoires
        </span>
        <!--
        <div class="form-group required">
          <label class="fw-bold" for="login">Votre identifiant</label>
          <input
            type="text"
            formControlName="login"
            autocomplete="username"
            appUppercase
            id="login"
            class="form-control"
            [attr.aria-invalid]="f.login.dirty && f.login.errors ? true : false"
            [attr.aria-describedby]="
              f.login.dirty && f.login.errors ? 'invalid-login' : null
            "
            [readonly]="this.mode === 'login-change-password'"
            [ngClass]="{
              'is-invalid': f.login.dirty && f.login.errors
            }"
          />
          <p
            *ngIf="f.login.dirty && f.login.errors"
            class="invalid-feedback-custom"
            id="invalid-login"
          >
            Veuillez vérifier l'identifiant. Celui-ci se trouve sur le document
            que vous à remit la structure.
          </p>
        </div>
        <ng-container *ngIf="this.mode === 'login-change-password'">
          <p>
            C'est votre première connexion, veuillez choisir un nouveau mot de
            passe:
          </p>
          <div class="form-group required">
            <label class="fw-bold" for="newPassword"
              >Nouveau mot de passe</label
            >
            <div class="input-group">
              <input
                id="newPassword"
                formControlName="newPassword"
                [type]="!hidePasswordNew ? 'text' : 'password'"
                class="form-control"
                autocomplete="new-password"
                [ngClass]="{
                  'is-invalid': f.newPassword.dirty && f.newPassword.errors
                }"
                [attr.aria-invalid]="
                  f.newPassword.dirty && f.newPassword.errors ? true : false
                "
                aria-describedby="invalid-password"
              />
              <div class="input-group-append">
                <button
                  type="button"
                  role="switch"
                  class="input-group-text"
                  [attr.aria-label]="
                    (hidePasswordNew ? 'Afficher' : 'Masquer') +
                    ' le mot de passe'
                  "
                  [attr.aria-checked]="!hidePasswordNew"
                  (click)="this.hidePasswordNew = !this.hidePasswordNew"
                >
                  <fa-icon
                    aria-hidden="true"
                    [icon]="
                      hidePasswordNew ? ['far', 'eye'] : ['far', 'eye-slash']
                    "
                  ></fa-icon>
                </button>
              </div>
            </div>
            <div
              *ngIf="f.newPassword?.dirty && f.newPassword?.errors"
              class="invalid-feedback-custom"
            >
              <p *ngIf="f.newPassword.errors?.required">
                Le mot de passe ne respecte pas les règles indiquées
              </p>
            </div>
          </div>

          <div class="row indications" id="invalid-password">
            <p
              class="my-1"
              [ngClass]="
                f.newPassword.errors?.required ||
                f.newPassword.errors?.hasNumber
                  ? 'text-danger'
                  : 'text-success'
              "
            >
              <fa-icon
                aria-hidden="true"
                [icon]="[
                  'fas',
                  f.newPassword.errors?.required ||
                  f.newPassword.errors?.hasNumber
                    ? 'times-circle'
                    : 'check-circle'
                ]"
              ></fa-icon>
              Au moins 1 chiffre
            </p>
            <p
              class="my-1"
              [ngClass]="
                f.newPassword.errors?.required ||
                f.newPassword.errors?.hasCapitalCase
                  ? 'text-danger'
                  : 'text-success'
              "
            >
              <fa-icon
                [icon]="[
                  'fas',
                  f.newPassword.errors?.required ||
                  f.newPassword.errors?.hasCapitalCase
                    ? 'times-circle'
                    : 'check-circle'
                ]"
                aria-hidden="true"
              ></fa-icon>
              Au moins une lettre en majuscule
            </p>
            <p
              class="my-1"
              [ngClass]="
                f.newPassword.errors?.required ||
                f.newPassword.errors?.hasLowerCase
                  ? 'text-danger'
                  : 'text-success'
              "
            >
              <fa-icon
                aria-hidden="true"
                [icon]="[
                  'fas',
                  f.newPassword.errors?.required ||
                  f.newPassword.errors?.hasLowerCase
                    ? 'times-circle'
                    : 'check-circle'
                ]"
              ></fa-icon>
              Au moins une lettre en minuscule
            </p>
            <p
              class="my-1"
              [ngClass]="
                f.newPassword.errors?.required ||
                f.newPassword.errors?.hasSpecialCharacter
                  ? 'text-danger'
                  : 'text-success'
              "
            >
              <fa-icon
                aria-hidden="true"
                [icon]="[
                  'fas',
                  f.newPassword.errors?.required ||
                  f.newPassword.errors?.hasSpecialCharacter
                    ? 'times-circle'
                    : 'check-circle'
                ]"
              ></fa-icon>
              Au moins un caractère spécial:
              &#64;[]^_!"#$%&amp;&apos;()*+,\-./:;&lbrace;&rbrace;&lt;&gt;=|~?
            </p>
            <p
              class="my-1"
              [ngClass]="
                f.newPassword.errors?.required ||
                f.newPassword.errors?.minlength ||
                f.newPassword.errors?.maxlength
                  ? 'text-danger'
                  : 'text-success'
              "
            >
              <fa-icon
                aria-hidden="true"
                [icon]="[
                  'fas',
                  f.newPassword.errors?.required ||
                  f.newPassword.errors?.minlength ||
                  f.newPassword.errors?.maxlength
                    ? 'times-circle'
                    : 'check-circle'
                ]"
              ></fa-icon>
              Doit contenir entre 12 et 150 caractères
            </p>
          </div>
          <div class="mt-3 form-group required">
            <label class="fw-bold" for="new-password-confirm"
              >Confirmation du mot de passe</label
            >
            <div class="input-group">
              <input
                id="new-password-confirm"
                formControlName="newPasswordConfirm"
                [type]="!hidePasswordNew ? 'text' : 'password'"
                class="form-control"
                autocomplete="new-password"
                [attr.aria-invalid]="
                  f.newPasswordConfirm.dirty &&
                  (f.newPasswordConfirm.errors ||
                    this.loginForm.hasError(
                      'new-password-confim-does-not-match'
                    ))
                    ? true
                    : false
                "
                aria-describedby="invalid-password"
                [ngClass]="{
                  'is-invalid':
                    f.newPasswordConfirm.dirty &&
                    (f.newPasswordConfirm.errors ||
                      this.loginForm.hasError(
                        'new-password-confim-does-not-match'
                      ))
                }"
              />
              <div class="input-group-append">
                <button
                  class="input-group-text"
                  [attr.aria-label]="
                    (hidePasswordNew ? 'Afficher' : 'Masquer') +
                    ' le mot de passe'
                  "
                  [attr.aria-checked]="!hidePasswordNew"
                  role="switch"
                  type="button"
                  (click)="this.hidePasswordNew = !this.hidePasswordNew"
                >
                  <fa-icon
                    aria-hidden="true"
                    [icon]="
                      hidePasswordNew ? ['far', 'eye'] : ['far', 'eye-slash']
                    "
                  ></fa-icon>
                </button>
              </div>
            </div>

            <p
              *ngIf="f.newPasswordConfirm.errors?.required"
              class="invalid-feedback-custom"
            >
              Veuillez confirmer le mot de passe
            </p>

            <div *ngIf="!f.newPasswordConfirm.errors?.required">
              <p
                *ngIf="
                  this.loginForm.hasError('new-password-confim-does-not-match')
                "
                class="invalid-feedback-custom"
              >
                La confirmation doit correspondre au nouveau mot de passe
              </p>
            </div>
          </div>
          <div class="col-md-12 required">
            <input
              type="checkbox"
              formControlName="acceptTerms"
              name="acceptTerms"
              class="form-check-input me-2"
              [ngClass]="{
                'is-invalid': f.acceptTerms.errors
              }"
              [attr.aria-describedby]="
                f.acceptTerms.errors ? 'invalid-cgu-choice' : null
              "
              id="acceptTerms"
              required
            />
            <label class="form-check-label" for="acceptTerms"
              >Je confirme avoir lu et accepter les
              <a routerLink="/cgu" target="_blank"
                >conditions générales d’utilisation</a
              ></label
            >
            <p
              *ngIf="f.acceptTerms.errors"
              class="invalid-feedback"
              id="invalid-cgu-choice"
            >
              Vous devez accepter les CGU afin de poursuivre l'inscription
            </p>
          </div>
        </ng-container>

        IMPORTANT: le champ de mot de passe situé juste après le login sera utilisé pour la mise à jour du mot de passe, donc il faut que ça soit le nouveau mot de passe le cas échéant 
        <div
          class="form-group required"
          *ngIf="this.mode !== 'login-change-password'"
        >
          <label class="fw-bold" for="password">Mot de passe</label>
          <div class="input-group">
            <input
              id="password"
              formControlName="password"
              [type]="!hidePassword ? 'text' : 'password'"
              class="form-control"
              autocomplete="current-password"
              [ngClass]="{
                'is-invalid': f.password.dirty && f.password.errors
              }"
            />
            <div class="input-group-append">
              <button
                type="button"
                class="input-group-text"
                [attr.aria-label]="
                  (hidePassword ? 'Afficher' : 'Masquer') + ' le mot de passe'
                "
                [attr.aria-checked]="!hidePassword"
                role="switch"
                (click)="this.hidePassword = !this.hidePassword"
              >
                <fa-icon
                  aria-hidden="true"
                  [icon]="hidePassword ? ['far', 'eye'] : ['far', 'eye-slash']"
                ></fa-icon>
              </button>
            </div>
          </div>
          <div
            *ngIf="f.password.dirty && f.password.errors"
            class="invalid-feedback-custom"
          >
            <p *ngIf="f.password.errors.required">
              Le mot de passe est obligatoire
            </p>
          </div>
        </div>
        <div class="mt-5 form-group text-center">
          <button
            type="button"
            *ngIf="this.mode === 'login-change-password'"
            class="btn btn-outline-primary me-5"
            (click)="this.switchToLoginOnly()"
          >
            Annuler
          </button>
          <button [disabled]="loading" type="submit" class="btn btn-primary">
            <span *ngIf="!loading">Connexion</span>
            <span *ngIf="loading">
              <fa-icon
                aria-hidden="true"
                [icon]="['fas', 'circle-notch']"
                animation="spin"
              ></fa-icon>
              Connexion en cours...
            </span>
          </button>
          <br />
          <br />

          <button
            type="button"
            class="btn btn-outline-primary"
            [attr.aria-expanded]="displayPasswordIndication"
            aria-controls="pwd-infos"
            (click)="displayPasswordIndication = !displayPasswordIndication"
          >
            Mot de passe oublié
          </button>

          <p class="my-4" id="pwd-infos" *ngIf="displayPasswordIndication">
            Vous avez peut-être bloqué votre compte en faisant plus de 3
            tentatives de connexion avec un mauvais mot de passe.
            <br />
            <b>Veuillez réessayer dans une heure.</b>

            <br />
            <br />
            Vous souhaitez changer de mot de passe ?
            <br />
            <b
              >Rendez-vous dans votre centre de domiciliation et demandez à un
              agent un nouveau mot passe.</b
            >
          </p>
        </div>
        -->
        <dsfr-form-input
          id="login"
          type="email"
          formControlName="login"
          [hint]="'Format attendu : WKYJBDXS'"
          [required]="true"
          label="identifiant"
        ></dsfr-form-input>
        <dsfr-form-password
          id="password"
          formControlName="password"
          [required]="true"
          label="Mot de passe"
        ></dsfr-form-password>
        <div class="col-12 col-md-12 d-flex">
          <dsfr-link
            [disabled]="false"
            [iconPosition]="'right'"
            [label]="'Mot de passe oublié ?'"
            [link]="'#'"
          ></dsfr-link>
        </div>
        <dsfr-button
          class="col-12 col-md-12 col-sm-12 w-100"
          [label]="'Se connecter'"
          [type]="'submit'"
          [tooltipMessage]="''"
          [variant]="'primary'"
          [size]="'SM'"
          [icon]="undefined"
          [disabled]="false"
          [ariaLabel]="''"
          [invertedOutlineContrast]="false"
          [buttonId]="''"
          [ariaControls]="''"
          [customClass]="''"
        ></dsfr-button>
      </form>
    </div>
    <div class="col-12 col-md-6 col-sm-6 content-container bg-white">
      <div class="row d-flex gap-1 align-self-stretch align-content-center">
        <div class="col-12 col-md-6 col-sm-6">
          <img
            class="img-fluid"
            src="assets/images/logo-dsfr.svg"
            alt="Logo Mon Domifa"
          />
        </div>
        <h5>Mon DomiFa facilite votre domiciliation</h5>
        <p class="content-container_text">
          Retrouvez toutes vos informations de domiciliation et vérifiez que
          vous avez du courrier.
        </p>
        <div class="col-12 col-md-12 col-sm-12 justify-content-center d-flex">
          <img
            class="img-fluid"
            src="assets/images/login/main-container.svg"
            alt="Illustration de
        boîte aux lettres"
          />
        </div>
      </div>
    </div>
  </section>
  <hr />
  <section class="row d-flex login-page_faq-section">
    <div class="d-flex flex-column">
      <h2>Les questions fréquentes</h2>
      <dsfr-accordion
        *ngFor="
          let item of [
            'Qu’est-ce que Mon DomiFa ?',
            'Est-ce un service payant ?',
            'Comment me connecter à mon espace personnel ?',
            'Que faire si j’ai perdu mes identifiants ?',
            'Puis-je faire une demande en ligne (renouvellement, Cerfa, etc.) ?'
          ]
        "
        [content]="'content'"
        [expanded]="false"
        [heading]="item"
        [headingLevel]="'H2'"
        [headingAriaLabel]="'headingAriaLabel'"
      >
        <p>
          Lorem ipsum dolor sit amet, consectetur adipiscing,
          <a href="https://www.systeme-de-design.gouv.fr/" target="_blank"
            >link test</a
          >
          incididunt, ut labore et dolore magna aliqua. Vitae sapien
          pellentesque habitant morbi tristique senectus et. Diam maecenas sed
          enim ut. Accumsan lacus vel facilisis volutpat est. Ut aliquam purus
          sit amet luctus. Lorem ipsum dolor sit amet consectetur adipiscing
          elit ut.
        </p>
        <p>
          Lorem ipsum dolor sit amet, consectetur adipiscing,
          <a href="https://www.systeme-de-design.gouv.fr/" target="_blank"
            >link test</a
          >
          incididunt, ut labore et dolore magna aliqua. Vitae sapien
          pellentesque habitant morbi tristique senectus et. Diam maecenas sed
          enim ut. Accumsan lacus vel facilisis volutpat est. Ut aliquam purus
          sit amet luctus. Lorem ipsum dolor sit amet consectetur adipiscing
          elit ut.
        </p>
        <ul>
          <li>list item</li>
          <li>list item</li>
          <li>list item</li>
        </ul>
      </dsfr-accordion>
      <dsfr-button
        class="mt-4 align-self-center"
        [label]="'Consulter la FAQ'"
        [type]="'button'"
        [tooltipMessage]="''"
        [variant]="'secondary'"
        [size]="'LG'"
        [icon]="undefined"
        [disabled]="false"
        [ariaLabel]="''"
        [invertedOutlineContrast]="false"
        [buttonId]="''"
        [ariaControls]="''"
        [customClass]="''"
      ></dsfr-button>
    </div>
  </section>
  <section class="login-page_contact-section">
    <div
      class="col-10 col-md-10 col-sm-10 mx-auto my-5 d-flex flex-column text-center"
    >
      <div class="row d-flex flex-row">
        <h2>
          Pour toute question complémentaire, vous pouvez écrire au support Mon
          DomiFa
        </h2>
        <div class="col-2">
          <img
            src="/assets/images/login/contact.svg"
            alt="Contacter l'équipe "
          />
        </div>
      </div>
      <dsfr-button
        class="mt-4 align-self-center"
        [label]="'Contacter mon centre de domiciliation'"
        [type]="'button'"
        [tooltipMessage]="''"
        [size]="'LG'"
        [variant]="'secondary'"
        [icon]="undefined"
        [disabled]="false"
        [ariaLabel]="''"
        [invertedOutlineContrast]="false"
        [buttonId]="''"
        [ariaControls]="''"
        [customClass]="''"
      ></dsfr-button>
    </div>
  </section>
</div>
