<div *ngIf="usager">
  <div
    *ngIf="
      usager.decision.statut === 'INSTRUCTION' &&
      usager.typeDom === 'RENOUVELLEMENT'
    "
    class="my-2 px-3"
  >
    <div class="alert alert-warning">
      <div aria-hidden="true" class="svg-icon icon-calendar"></div>
      <span class="content"
        >Demande de renouvellement actuellement en cours</span
      >
    </div>
  </div>

  <div class="my-2" *ngIf="!usager.lastInteraction.enAttente">
    <h2 class="fr-text-title--blue-france mb-2">Votre courrier</h2>
    <div class="border-top border-1 border-grey pt-3 mb-2">
      <div class="fr-callout fr-callout--empty">
        <h2 class="fr-callout__title">Vous n’avez pas de nouveau courrier</h2>
        <p class="fr-callout__text">
          Revenez régulièrement, nous mettons ces informations à jour
          quotidiennement
        </p>
      </div>
    </div>
  </div>

  <div
    *ngIf="usager.lastInteraction.enAttente"
    class="fr-text-title--blue-france my-2"
  >
    <h2 class="fr-text-title--blue-france mb-2">
      Vous avez du courrier à retirer !
    </h2>

    <div class="border-top border-1 border-grey pt-3 mb-2">
      <div class="d-flex align-items-top">
        <div class="d-flex flex-column gap-2">
          <ng-container *ngIf="usager.lastInteraction.courrierIn > 0">
            <div class="d-flex gap-2">
              <span
                class="fr-icon-mail-open-line align-self-start fr-mt-1-5v"
              ></span>
              <div class="d-flex flex-column gap-1">
                <div>
                  <h3 class="fr-h3 mb-0 fr-text-title--blue-france">
                    {{ usager.lastInteraction.courrierIn }}
                    <span class="fr-text--lead">
                      courrier<ng-container
                        *ngIf="usager.lastInteraction.courrierIn > 1"
                        >s</ng-container
                      >
                    </span>
                  </h3>
                </div>
                <div
                  class="d-flex flex-column ms-2 gap-1 ps-3 fr-border-left-blue-france"
                  *ngIf="pendingInteractions.courrierIn"
                >
                  <div
                    class="d-flex gap-1 flex-column"
                    *ngFor="
                      let interaction of groupedPendingInteractions?.courrierIn
                        | keyvalue
                    "
                  >
                    {{ interaction.key | date : "dd MMMM yyyy" }}
                    <ng-container *ngIf="interaction.value.numberOfItems > 1">
                      - ({{ interaction.value.numberOfItems }})</ng-container
                    >
                    <ng-container *ngIf="interaction.value.comments">
                      <div
                        *ngFor="let comment of interaction.value.comments"
                        class="d-flex align-items-start fr-text--xs gap-1 fr-tag fr-tag--sm"
                      >
                        <small
                          aria-hidden="true"
                          class="fr-icon-message-3-line"
                        ></small>
                        <span class="visually-hidden">
                          Commentaires sur les courriers
                        </span>
                        <span [innerHTML]="comment | nl2br"></span>
                      </div>
                    </ng-container>
                  </div>
                </div>
              </div>
            </div>
          </ng-container>
          <ng-container *ngIf="usager.lastInteraction.colisIn > 0">
            <div class="d-flex gap-2">
              <span
                class="fr-icon-archive-line align-self-start fr-mt-1-5v"
              ></span>
              <div class="d-flex flex-column gap-1">
                <div>
                  <h3 class="mb-0 fr-text-title--blue-france">
                    {{ usager.lastInteraction.colisIn }}
                    <span class="fr-text--lead">colis</span>
                  </h3>
                </div>
                <div
                  class="d-flex flex-column ms-2 gap-1 ps-3 fr-border-left-blue-france"
                  *ngIf="pendingInteractions.colisIn"
                >
                  <div
                    *ngFor="
                      let interaction of groupedPendingInteractions?.colisIn
                        | keyvalue
                    "
                  >
                    {{ interaction.key | date : "dd MMMM yyyy" }}
                    <ng-container *ngIf="interaction.value.numberOfItems > 1">
                      - ({{ interaction.value.numberOfItems }})</ng-container
                    >
                    <ng-container *ngIf="interaction.value.comments">
                      <div
                        *ngFor="let comment of interaction.value.comments"
                        class="d-flex align-items-start fr-text--xs gap-1 fr-tag fr-tag--sm"
                      >
                        <small
                          aria-hidden="true"
                          class="fr-icon-message-3-line"
                        ></small>
                        <span class="visually-hidden"
                          >Commentaires sur les colis
                        </span>
                        <span [innerHTML]="comment | nl2br"></span>
                      </div>
                    </ng-container>
                  </div>
                </div>
              </div>
            </div>
          </ng-container>

          <ng-container *ngIf="usager.lastInteraction.recommandeIn > 0">
            <div class="d-flex gap-2">
              <span
                class="fr-icon-mail-star-line align-self-start fr-mt-1-5v"
              ></span>
              <div class="d-flex flex-column gap-1">
                <div>
                  <h3 class="mb-0 fr-text-title--blue-france">
                    {{ usager.lastInteraction.recommandeIn }}
                    <span class="fr-text--lead"> avis de passage</span>
                  </h3>
                </div>
                <ng-container *ngIf="pendingInteractions.recommandeIn">
                  <div
                    class="d-flex flex-column ms-2 gap-1 ps-3 fr-border-left-blue-france"
                    *ngFor="
                      let interaction of groupedPendingInteractions?.recommandeIn
                        | keyvalue
                    "
                  >
                    {{ interaction.key | date : "dd MMMM yyyy" }}
                    <ng-container *ngIf="interaction.value.numberOfItems > 1">
                      - ({{ interaction.value.numberOfItems }})</ng-container
                    >
                    <ng-container *ngIf="interaction.value.comments">
                      <div
                        *ngFor="let comment of interaction.value.comments"
                        class="d-flex align-items-start fr-text--xs gap-1 fr-tag fr-tag--sm"
                      >
                        <small
                          aria-hidden="true"
                          class="fr-icon-message-3-line"
                        ></small>
                        <span class="visually-hidden"
                          >Commentaires sur les avis de passage</span
                        >
                        <span [innerHTML]="comment | nl2br"></span>
                      </div>
                    </ng-container>
                  </div>
                </ng-container>
              </div>
            </div>
          </ng-container>
        </div>
      </div>
    </div>
  </div>
  <div class="text-center">
    <a
      routerLink="/account/historique"
      ariaCurrentWhenActive="page"
      class="fr-btn fr-btn--md fr-btn--secondary gap-1 mt-4 mb-2"
    >
      <span aria-hidden="true" class="fr-icon-time-line"></span>
      Consultez le détail des interactions
    </a>
  </div>
</div>
