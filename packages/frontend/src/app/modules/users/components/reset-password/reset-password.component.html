<div class="fr-background-alt--grey h-100">
  <div class="col-12 col-md-12 px-2">
    <ng-container *ngIf="!token">
      <div class="mx-auto py-5" *ngIf="success">
        <div class="text-center">
          <fa-icon
            aria-hidden="true"
            class="fa-4x fr-text-default--success"
            [icon]="['fas', 'check-circle']"
          ></fa-icon>
        </div>

        <h1 class="fr-h2 my-3">
          Vous venez de recevoir un mail pour réinitialiser votre mot de passe
        </h1>
        <p>N'oubliez pas de vérifier vos spams.</p>

        <div class="fr-input-group">
          <a
            routerLink="/connexion"
            type="button"
            class="fr-btn d-flex flex-column w-100"
          >
            Revenir à la connexion
          </a>
        </div>
      </div>

      <div
        class="d-flex flex-column gap-3 py-5 px-3"
        *ngIf="!success && emailForm"
      >
        <h1 class="fr-h2">Vous avez oublié votre mot de passe ?</h1>
        <p>
          Veuillez saisir l'adresse email de votre compte afin de recevoir la
          procédure pour le réinitialiser
        </p>

        <form
          class="d-flex flex-column gap-3"
          [formGroup]="emailForm"
          (ngSubmit)="submitEmailForm()"
        >
          <p class="fr-text-default--error">* champs obligatoires</p>
          <div class="col">
            <div
              [class.fr-input-group--error]="
                (submitted || e.email.dirty) && e.email.errors
              "
              class="fr-input-group required col-12 col-md-12"
            >
              <label class="fr-label" for="email">Adresse email </label>
              <input
                type="email"
                id="email"
                formControlName="email"
                name="email"
                autocomplete="email"
                class="fr-input"
                [attr.aria-invalid]="
                  (submitted || e.email.dirty) && e.email.errors ? true : false
                "
                [attr.aria-describedby]="
                  (submitted || e.email.dirty) && e.email.errors
                    ? 'email-errors'
                    : null
                "
                required
              />

              <div
                *ngIf="(submitted || e.email.dirty) && e.email.errors"
                id="email-errors"
                class="fr-messages-group"
                aria-live="polite"
              >
                <p class="fr-message fr-message--error">
                  Veuillez vérifier l'adresse email, format attendu :
                  nom&#64;domaine.fr
                </p>
              </div>
            </div>
          </div>
          <div class="fr-input-group text-center">
            <button
              type="submit"
              [disabled]="loading"
              [attr.aria-busy]="loading"
              class="fr-btn d-flex flex-column w-100"
            >
              <span *ngIf="loading">
                <fa-icon
                  [icon]="['fas', 'circle-notch']"
                  aria-hidden="true"
                  animation="spin"
                >
                </fa-icon>
                Veuillez patienter...
              </span>
              <span *ngIf="!loading">Envoyer</span>
            </button>
          </div>
        </form>
      </div>
    </ng-container>

    <ng-container *ngIf="token">
      <div class="mx-auto py-5" *ngIf="success">
        <div class="text-center">
          <fa-icon
            aria-hidden="true"
            class="fa-4x fr-text-default--success"
            [icon]="['fas', 'check-circle']"
          ></fa-icon>
        </div>

        <h2>Félicitations, votre mot de passe a été réinitialisé</h2>

        <div class="fr-input-group">
          <a
            routerLink="/connexion"
            type="button"
            class="fr-btn d-flex flex-column w-100"
          >
            Revenir à la connexion
          </a>
        </div>
      </div>

      <div *ngIf="!success">
        <h1 class="fr-h2">Réinitialiser mon mot de passe</h1>
        <h2 class="fr-h3">Veuillez saisir un nouveau mot de passe</h2>

        <p class="fr-text-default--error">* champs obligatoires</p>
        <form
          [formGroup]="resetForm"
          *ngIf="resetForm"
          (ngSubmit)="submitResetForm()"
        >
          <app-user-structure-password-form
            [parentFormGroup]="resetForm"
            [submitted]="submitted"
          ></app-user-structure-password-form>

          <div class="my-4">
            <input type="hidden" formControlName="token" name="token" />
            <button
              type="submit"
              [disabled]="resetForm.invalid"
              class="fr-btn d-flex flex-column w-100"
            >
              Enregistrer
            </button>
          </div>
        </form>
      </div>
    </ng-container>
  </div>
</div>
