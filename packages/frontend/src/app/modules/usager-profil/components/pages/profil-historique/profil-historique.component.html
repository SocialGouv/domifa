<app-profil-head
  *ngIf="usager"
  [usager]="usager"
  [section]="'historique'"
  [me]="me"
>
</app-profil-head>

<div class="content" *ngIf="usager && me">
  <div class="container p-0">
    <div class="page-content p-3">
      <div class="row">
        <div class="col-md-12">
          <h2>Historique des décisions</h2>
          <div class="alert alert-info" *ngIf="usager.historique.length === 0">
            <p>Aucun historique de décision n'est enregistré</p>
          </div>
          <div class="table-responsive">
            <table
              *ngIf="usager.historique.length > 0"
              class="table table-hover"
            >
              <caption class="visually-hidden">
                Historique des décisions
              </caption>
              <thead>
                <tr>
                  <th scope="col">Date</th>
                  <th scope="col">Type de décision</th>
                  <th scope="col">Responsable</th>
                  <th scope="col" class="text-end">Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr
                  *ngFor="let histo of usager.historique; let i = index"
                  [attr.aria-rowindex]="i + 1"
                >
                  <td>
                    {{ histo.dateDecision | date : "dd/MM/yyyy à HH:mm" }}
                  </td>
                  <td>
                    {{ USAGER_DECISION_STATUT_LABELS_PROFIL[histo.statut] }}
                    <span
                      *ngIf="
                        histo.statut === 'REFUS' || histo.statut === 'RADIE'
                      "
                    >
                      le {{ histo.dateDebut | date : "dd/MM/yyyy" }}
                    </span>

                    <span *ngIf="histo.statut === 'VALIDE'">
                      du
                      <strong>
                        {{ histo.dateDebut | date : "dd/MM/yyyy" }}
                      </strong>
                      au
                      <strong>{{ histo.dateFin | date : "dd/MM/yyyy" }}</strong>
                    </span>
                    <div *ngIf="histo.statut === 'RADIE'">
                      {{ histo.motifString }}
                    </div>
                  </td>
                  <td>{{ histo.userName }}</td>
                  <td class="text-end">
                    <app-delete-usager-menu
                      *ngIf="i === 0"
                      [usager]="usager"
                      context="HISTORY"
                      [me]="me"
                    ></app-delete-usager-menu>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <app-profil-historique-procurations
        [me]="me"
        [usager]="usager"
      ></app-profil-historique-procurations>

      <app-profil-historique-transferts
        [me]="me"
        [usager]="usager"
      ></app-profil-historique-transferts>

      <div
        class="row"
        *ngIf="
          me.structure.sms.enabledByDomifa &&
          me.structure.sms.enabledByStructure
        "
      >
        <div class="col-md-12">
          <h2>Historique des envois de SMS</h2>

          <ul class="mb-4">
            <li>
              pour l'arrivée d'un courrier, envoi les mardis et jeudis à 19h
            </li>
            <li>
              pour le rappel d'échéance de domiciliation, envoi 2 mois avant la
              date de fin
            </li>
          </ul>

          <app-profil-historique-sms
            [usager]="usager"
          ></app-profil-historique-sms>
        </div>
      </div>
      <div class="row" *ngIf="usager">
        <div class="col-md-12">
          <h2>Historique des notes</h2>
          <app-profil-historique-notes
            [me]="me"
            [usager]="usager"
          ></app-profil-historique-notes>
        </div>
      </div>
    </div>

    <app-delete-usager-menu
      [usager]="usager"
      [me]="me"
      context="PROFIL"
    ></app-delete-usager-menu>
  </div>
</div>
