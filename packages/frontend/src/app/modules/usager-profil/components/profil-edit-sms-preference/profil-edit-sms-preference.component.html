<div class="d-flex justify-content-between align-items-center" *ngIf="usager">
  <div>
    <h4>Préférence de contact</h4>
  </div>
  <div class="text-end" *ngIf="!isRole('facteur')">
    <button
      title="Modifier les préférences"
      class="btn btn-outline-dark"
      *ngIf="!editPreferences"
      (click)="togglePreferences()"
    >
      <fa-icon [icon]="['far', 'edit']" class="me-2"></fa-icon>
      Modifier les préférences
    </button>
    <button
      title="Annuler les modifications"
      class="btn btn-outline-dark"
      *ngIf="editPreferences"
      (click)="togglePreferences()"
    >
      <fa-icon [icon]="['fas', 'times']" class="me-2"></fa-icon>
      Annuler les modifications
    </button>
  </div>
</div>

<div class="row" *ngIf="!editPreferences">
  <div class="col-md-6 reponses">
    <span class="question"
      >Le demandeur souhaite-t-il recevoir des notifications par SMS (arrivée
      d'un courrier, échéance de domiciliation) ?</span
    >
    <span class="valeur">
      {{ usager.preference.contactByPhone ? "OUI" : "NON" }}
    </span>
  </div>

  <div class="col-md-6 reponses">
    <span class="question">Numéro de téléphone</span>
    <span class="valeur"
      >{{ usager.preference.telephone | formatInternationalPhoneNumber }}
    </span>
  </div>
</div>

<form
  *ngIf="editPreferences"
  [formGroup]="preferenceForm"
  (ngSubmit)="updateUsagerPreference()"
  autocomplete="off"
>
  <div class="row">
    <div class="col-md-7">
      <fieldset>
        <legend class="label">
          Le demandeur souhaite-t-il recevoir des notifications par SMS (arrivée
          d'un courrier, échéance de domiciliation) ?
        </legend>

        <div class="form-check form-check-inline">
          <input
            class="form-check-input"
            type="radio"
            formControlName="contactByPhone"
            id="sms_oui"
            [value]="true"
          />
          <label class="form-check-label" for="sms_oui"> Oui </label>
        </div>
        <div class="form-check form-check-inline">
          <input
            class="form-check-input"
            type="radio"
            formControlName="contactByPhone"
            id="sms_non"
            [value]="false"
          />
          <label class="form-check-label" for="sms_non"> Non </label>
        </div>
      </fieldset>
    </div>
    <div
      class="col-md-5 required form-group"
      *ngIf="formPref.contactByPhone.value === true"
    >
      <label for="telephone"
        >À quel numéro de téléphone ? (Numéro de portable uniquement)</label
      >
      <ngx-intl-tel-input
        [cssClass]="
          submitted && (formPref.telephone.errors || formPref.telephone.invalid)
            ? 'form-control is-invalid'
            : 'form-control'
        "
        [preferredCountries]="preferredCountries"
        [enableAutoCountrySelect]="true"
        [enablePlaceholder]="true"
        [searchCountryFlag]="true"
        searchCountryPlaceholder="Choisissez votre pays"
        [searchCountryField]="[
          SearchCountryField.Iso2,
          SearchCountryField.Name
        ]"
        [selectedCountryISO]="usager.preference.telephone.countryCode"
        [maxLength]="15"
        [phoneValidation]="true"
        [separateDialCode]="true"
        [inputId]="'telephone'"
        [numberFormat]="PhoneNumberFormat.National"
        formControlName="telephone"
      ></ngx-intl-tel-input>
      <p
        *ngIf="
          submitted && (formPref.telephone.errors || formPref.telephone.invalid)
        "
        class="invalid-feedback-custom"
      >
        Veuillez un numéro de téléphone portable valide
      </p>
    </div>
  </div>

  <div class="col-md-4 offset-md-4 text-center">
    <button
      type="submit"
      [disabled]="loading"
      class="btn btn-primary btn-block"
    >
      <span *ngIf="!loading">Enregistrer les préférences</span>
      <span *ngIf="loading">
        <fa-icon [icon]="['fas', 'circle-notch']" [spin]="true"> </fa-icon>
        Veuillez patientez...
      </span>
    </button>
  </div>
</form>
