<app-profil-head [usager]="usager" [section]="'general'" [me]="me">
</app-profil-head>

<div class="content">
  <div class="container p-0">
    <div class="page-content pb-5 px-4">
      <div class="row">
        <div class="col-md-6">
          <div class="row">
            <h4 class="col-12">Dossier</h4>
            <div class="col-6">
              <span class="label">Référence dossier</span>
            </div>
            <div class="col-6">
              {{ usager.customRef }}
            </div>
            <div class="col-6">
              <span class="label">Statut</span>
            </div>
            <div class="col-6">
              <div class="label-statut" [class]="usager.statusInfos.color">
                <span>{{
                  DECISION_STATUT_LABELS[usager.decision.statut]
                }}</span>
              </div>
            </div>

            <div class="col-6"><span class="label">Ayants-droits</span></div>
            <div class="col-6">
              <ng-template #ayantsDroitsTooltip class="p-4 text-left">
                <div class="distribution-tooltip">
                  <div
                    class="p-1"
                    *ngFor="let ayantDroit of usager.ayantsDroits"
                  >
                    <b class="text-primary">{{ ayantDroit.nom }}</b>
                    {{ ayantDroit.prenom }}
                  </div>
                </div>
              </ng-template>
              <div
                class="label-info label-green"
                [ngbTooltip]="ayantsDroitsTooltip"
                *ngIf="usager.ayantsDroits.length"
              >
                <div>{{ usager.ayantsDroits.length }} ayants-droit</div>
              </div>
            </div>

            <div class="col-6"><span class="label">Échéance</span></div>
            <div class="col-6">
              {{ usager.dateToDisplay | date: "dd/MM/yyyy" }}
            </div>
            <div class="col-6">
              <span class="label">Dernier passage</span>
            </div>
            <div class="col-6">
              {{ usager.lastInteraction.dateInteraction | date: "dd/MM/yyyy" }}
            </div>
          </div>
        </div>

        <div class="col-md-6">
          <h4>Courrier en attente</h4>
          <div class="profil-interaction my-3">
            <div class="interaction-icon-box mr-3">
              <div class="interaction-icon icon-courrier"></div>
            </div>
            <div class="profil-interaction-label">
              <b>{{ usager.lastInteraction.courrierIn }}</b> courriers
            </div>
          </div>
          <div class="profil-interaction my-3">
            <div class="interaction-icon-box mr-3">
              <div class="interaction-icon icon-colis"></div>
            </div>
            <div class="profil-interaction-label">
              <b>{{ usager.lastInteraction.colisIn }}</b> colis
            </div>
          </div>
          <div class="profil-interaction my-3">
            <div class="interaction-icon-box mr-3">
              <div class="interaction-icon icon-recommande"></div>
            </div>
            <div class="profil-interaction-label">
              <b>{{ usager.lastInteraction.recommandeIn }}</b> avis de passage
            </div>
          </div>
          <div class="btn btn-primary mr-2" (click)="openInteractionInModal()">
            <span class="icon-reception list-icon"></span>
            <span class="list-icon-label">Réception</span>
          </div>

          <div
            *ngIf="usager.lastInteraction.enAttente"
            class="btn btn-outline-primary"
            (click)="openInteractionOutModal()"
          >
            <span class="icon-distribution list-icon"></span>
            <span class="list-icon-label">Distribuer le courrier</span>
          </div>
        </div>
      </div>
      <br />
      <hr />
      <div class="row">
        <div class="col-md-6">
          <h4>Historique des courriers</h4>

          <app-profil-historique-table-courriers
            [usager]="usager"
            [me]="me"
          ></app-profil-historique-table-courriers>
        </div>

        <div class="col-md-6">
          <h4>Notes</h4>
        </div>
      </div>
    </div>
    <app-delete-usager-menu [usager]="usager"></app-delete-usager-menu>
  </div>
</div>

<ng-template #setInteractionInModal let-modal>
  <app-set-interaction-in-form
    [(usager)]="usager"
    (cancelReception)="closeModals()"
  ></app-set-interaction-in-form>
</ng-template>

<ng-template #setInteractionOutModal let-modal>
  <app-set-interaction-out-form
    [(usager)]="usager"
    (cancelReception)="closeModals()"
  ></app-set-interaction-out-form>
</ng-template>
