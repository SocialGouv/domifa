<div class="w-100 fr-background-contrast--blue-ecume mb-0 pb-0">
  <div
    class="fr-container row d-flex flex-row justify-content-between align-items-center"
  >
    <div
      class="col-12 col-md-10 col-sm-10 py-3 py-md-5 d-flex flex-column gap-1"
    >
      <h1 class="fr-text-title--blue-france mb-1">
        Inscrire ma structure sur DomiFa
      </h1>
      <p class="fr-text--lg fr-text-title--blue-france">
        Vous êtes un CCAS, CIAS ou un organisme agréé et vous souhaitez utiliser
        un outil qui vous simplifie la gestion de la domiciliation des personnes
        sans domicile stable ? DomiFa est fait pour vous !
      </p>
    </div>

    <div class="col-2 d-none d-sm-block">
      <img
        class="fr-responsive-img"
        src="assets/images/home/inscription-structure.svg"
        alt=""
      />
    </div>
  </div>
</div>

<div class="fr-background-alt--grey h-100 mt-0 p-4">
  <div class="fr-container mt-0">
    <div>
      <div class="fr-background-default--grey p-4">
        <div
          *ngIf="!searchFailed && structures.length <= 0"
          class="d-flex flex-column"
        >
          <div>
            <h2 class="m-0">
              Votre structure existe peut-être déjà sur DomiFa ?
            </h2>
            <span class="fr-text--lg">
              DomiFa compte plusieurs milliers de structures— vérifiez si la
              vôtre en fait déjà partie.
            </span>
          </div>
          <div class="col-2 d-none d-sm-block align-self-center">
            <img
              class="fr-responsive-img"
              src="assets/images/home/recherche-structure.svg"
              alt=""
            />
          </div>
          <!-- Start Search bar-->
          <form [formGroup]="codePostalForm" (ngSubmit)="submitCodePostal()">
            <label class="fr-label mb-2" for="structure-search">
              Quel est le code postal de votre structure ?
            </label>
            <div
              *ngIf="!searchFailed && structures.length <= 0"
              class="fr-search-bar fr-search-bar--lg"
              id="search-lg"
              role="search"
            >
              <input
                class="fr-input"
                type="text"
                role="search"
                id="structure-search"
                placeholder="Rechercher"
                [ngClass]="{
                  'is-invalid':
                    (f.codePostal.dirty || submitted) && f.codePostal.errors,
                  'is-valid':
                    (f.codePostal.dirty || submitted) && !f.codePostal.errors
                }"
                [attr.aria-invalid]="
                  (f.codePostal.dirty || submitted) && f.codePostal.errors
                    ? true
                    : false
                "
                [attr.aria-describedby]="
                  (f.codePostal.dirty || submitted) && f.codePostal.errors
                    ? 'code-postal-error'
                    : null
                "
                formControlName="codePostal"
                name="codePostal"
                minlength="5"
                maxlength="5"
                autocomplete="postal-code"
                required
              />

              <button
                [disabled]="loading"
                [attr.aria-busy]="loading"
                type="submit"
                class="fr-btn"
              >
                <span *ngIf="loading">
                  <fa-icon
                    [icon]="['fas', 'circle-notch']"
                    aria-hidden="true"
                    animation="spin"
                  >
                  </fa-icon>
                  Veuillez patienter...
                </span>
                <span *ngIf="!loading"> Rechercher</span>
              </button>
            </div>

            <div
              *ngIf="f.codePostal.touched && f.codePostal.errors"
              class="fr-messages-group mt-2"
              id="code-postal-error"
            >
              <p class="fr-message--error">
                Code postal incorrect. Exemple: 75001
              </p>
            </div>
          </form>
          <!-- End search bar -->

          <div class="fr-background-default--grey py-2 fr-px-3v">
            <div class="row fr-background-alt--grey">
              <div class="col-2 col-md-2">
                <img
                  class="fr-responsive-img"
                  src="assets/images/home/mon-domifa.svg"
                  alt=""
                />
              </div>
              <div
                class="col-10 col-md-10 d-flex flex-column justify-content-center"
              >
                <h2 class="fr-h3 m-0">Vous êtes domicilié ?</h2>
                <p class="m-0">
                  La plateforme Mon DomiFa vous permet de suivre l'arrivée de
                  courrier dans votre structure
                </p>
                <div>
                  <a
                    href="https://mon-domifa.fabrique.social.gouv.fr/"
                    class="fr-link fr-icon-arrow-right-line fr-link--icon-right"
                  >
                    Accéder à Mon Domifa
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="py-2" *ngIf="searchFailed && structures.length === 0">
          <h2 class="m-0">
            Aucune structure n'est enregistrée dans votre ville.
          </h2>
          <div
            class="d-flex flex-column gap-1 justify-content-center align-items-center"
          >
            <div class="col-2 col-md-2">
              <img
                class="fr-responsive-img"
                src="assets/images/home/structure-introuvable.svg"
                alt=""
              />
            </div>
            <a
              class="fr-btn"
              [routerLink]="['/structures/nouveau']"
              ariaCurrentWhenActive="page"
            >
              J'inscris ma structure
            </a>
          </div>
        </div>
        <div class="py-3 px-3" *ngIf="structures.length > 0">
          <h2 class="m-0">
            Voici les structures utilisatrices de DomiFa dans votre département
          </h2>
          <p class="mt-0 mb-3 fw-bold">
            Si vous appartenez à l’une de ces structures, un membre de celle-ci
            doit vous donner accès :
          </p>

          <ul class="ps-0 list-unstyled">
            <li
              class="py-4 px-4 mt-2 border border-grey"
              *ngFor="let structure of structures"
            >
              <div class="d-flex gap-2 flex-column">
                <h3 class="fr-h5 mb-0 fr-text-title--blue-france">
                  {{ structure.nom }}
                </h3>
                <span class="fr-text-default--grey">
                  {{ structure.adresse }}, {{ structure.codePostal }},
                  {{ structure.ville }}</span
                >
              </div>
            </li>
          </ul>

          <div class="py-3 d-flex justify-content-between align-items-baseline">
            <p>
              Vous ne trouvez pas votre structure dans la liste ? Inscrivez-là
              dès maintenant !
            </p>
            <a
              class="fr-btn"
              [routerLink]="['/structures/nouveau']"
              ariaCurrentWhenActive="page"
            >
              J'inscris ma structure
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
