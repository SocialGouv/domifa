<div class="w-100 fr-background-contrast--blue-ecume mb-0 pb-0">
  <div
    class="fr-container row d-flex flex-row justify-content-between align-items-center"
  >
    <div
      class="col-12 col-md-10 col-sm-10 py-3 py-md-5 d-flex flex-column gap-1"
    >
      <h1 class="fr-text-title--blue-france mb-1">
        Inscrire ma structure sur DomiFa
      </h1>
      <p class="fr-text--lg fr-text-title--blue-france">
        Vous êtes un CCAS, CIAS ou un organisme agréé et vous souhaitez utiliser
        un outil qui vous simplifie la gestion de la domiciliation des personnes
        sans domicile stable ? DomiFa est fait pour vous !
      </p>
    </div>

    <div class="col-2 d-none d-sm-block">
      <img
        class="fr-responsive-img"
        src="assets/images/home/inscription-structure.svg"
        alt=""
      />
    </div>
  </div>
</div>
<div class="fr-background-alt--grey py-3">
  <div class="fr-container fr-background-default--grey py-3">
    <div *ngIf="showRegisterSuccess">
      <div class="row d-flex justify-content-center text-center gap-3">
        <div>
          <img
            class="fr-img-fluid"
            src="assets/images/register/success-structure.svg"
            alt=""
            aria-hidden="true"
          />
        </div>
        <div>
          <h2>Votre compte est en cours de validation !</h2>
          <span>Cette étape peut prendre jusqu’à 7 jours maximum.</span>
        </div>

        <p>
          Merci pour votre demande de création de compte structure sur DomiFa.
          <br />
          Votre demande a bien été enregistrée et est actuellement en cours de
          validation par notre équipe.
        </p>
        <div
          class="d-flex flex-column fr-background-alt--blue-france py-4 gap-4"
        >
          <div class="d-flex gap-1 justify-content-center align-items-center">
            <img
              src="assets/dsfr-pictograms/buildings/companie.svg"
              alt=""
              aria-hidden="true"
            />
            <p class="fw-bold mb-0">
              En attendant l’activation de votre compte, vous pouvez :
            </p>
          </div>
          <div class="d-flex flex-column align-items-center gap-1">
            <span class="mb-0"
              >Vous inscrire à une session de formation en ligne</span
            >
            <a href="https://tally.so/r/3EaAVB" class="fr-btn" target="_blank">
              M'inscrire</a
            >
          </div>
          <div class="d-flex flex-column align-items-center gap-1">
            <span class="mb-0"
              >Consulter notre FAQ dédiée aux utilisateurs
            </span>
            <a routerLink="/faq" class="fr-btn gap-2">
              <span class="fr-icon-question-line" aria-hidden="true"></span>
              Accéder à la FAQ
            </a>
          </div>
        </div>
      </div>
    </div>

    <div
      *ngIf="!showRegisterSuccess"
      class="fr-background-default--grey py-2 px-4"
    >
      <!-- Form header -->
      <div class="fr-stepper mb-2">
        <h2 class="fr-stepper__title">
          {{ stepsLabels[structureRegisterInfos.etapeInscription] }}
          <span class="fr-stepper__state"
            >Étape {{ structureRegisterInfos.etapeInscription + 1 }} sur 2</span
          >
        </h2>
        <div
          class="fr-stepper__steps"
          [attr.data-fr-current-step]="
            structureRegisterInfos.etapeInscription + 1
          "
          data-fr-steps="2"
        ></div>
        <p class="fr-stepper__details">
          <span class="fr-text--bold">Étape suivante :</span> Création du compte
        </p>
      </div>

      <p class="text-danger my-3">* champs obligatoires</p>

      <form
        *ngIf="structureRegisterInfos.etapeInscription === 0 && structureForm"
        [formGroup]="structureForm"
        (ngSubmit)="submitStrucutre()"
      >
        <!-- Structure -->
        <section>
          <div class="d-flex flex-column justify-content-center">
            <div class="d-flex gap-1 align-items-end my-1">
              <img
                class="fr-width-2-5rem"
                src="assets/dsfr-pictograms/buildings/companie.svg"
                aria-hidden="true"
                alt=""
              />
              <h2 class="m-0">Structure</h2>
            </div>
            <p>
              Veuillez saisir les coordonnées de votre structure, celles-ci
              apparaitront sur le Cerfa d’attestation :
            </p>
            <fieldset
              class="fr-fieldset fr-background-alt--blue-france py-3 px-3 mx-1"
              id="type-strcture-choice"
              aria-labelledby="type-structure-choice-legend"
            >
              <legend
                class="fr-fieldset__legend--regular fr-fieldset__legend mb-0 fw-bold"
                id="type-structure-choice-legend"
              >
                A quel type de structure appartenez-vous ?
              </legend>
              <div class="fr-fieldset__element fr-fieldset__element--inline">
                <div class="fr-radio-group">
                  <input
                    id="cias"
                    formControlName="structureType"
                    name="structureType"
                    type="radio"
                    value="cias"
                  />
                  <label for="cias" class="fr-label"> CIAS </label>
                </div>
              </div>
              <div class="fr-fieldset__element fr-fieldset__element--inline">
                <div class="fr-radio-group">
                  <input
                    formControlName="structureType"
                    name="structureType"
                    type="radio"
                    id="ccas"
                    value="ccas"
                  />
                  <label for="ccas" class="fr-label">
                    CCAS / Commune / Mairie
                  </label>
                </div>
              </div>
              <div class="fr-fieldset__element fr-fieldset__element--inline">
                <div class="fr-radio-group">
                  <input
                    formControlName="structureType"
                    name="structureType"
                    type="radio"
                    value="asso"
                    id="asso"
                  />
                  <label for="asso" class="fr-label"> Organisme agréé </label>
                </div>
              </div>
              <div
                *ngIf="submitted && f.structureType.value === null"
                class="fr-messages-group"
                id="type-structure-choice-legend-messages"
                aria-live="polite"
              >
                <p class="fr-message fr-message--error">
                  Veuillez saisir les coordonnées de votre structure, celles-ci
                  apparaitront sur le Cerfa d’attestation :
                </p>
              </div>
            </fieldset>
          </div>

          <div class="row py-1">
            <div
              [class.fr-input-group--error]="
                (f.nom.dirty || submitted) && f.nom.errors
              "
              class="col-md-12 fr-input-group required"
            >
              <label class="fr-label" for="nom"
                >Raison sociale (nom de la structure)</label
              >
              <input
                type="text"
                class="fr-input mb-0"
                id="nom"
                autocomplete="organization"
                formControlName="nom"
                name="nom"
                [attr.aria-invalid]="
                  (f.adresse.dirty || submitted) && f.nom.errors ? true : false
                "
                [attr.aria-describedby]="
                  (f.nom.dirty || submitted) && f.nom.errors
                    ? 'nom-errors'
                    : 'nom-structure-description'
                "
                required
              />

              <div
                class="fr-messages-group"
                id="type-structure-choice-legend-messages"
                aria-live="polite"
              >
                <ul class="fr-messages-group ps-0">
                  <li
                    id="nom-structure-description"
                    *ngIf="!((f.nom.dirty || submitted) && f.nom.errors)"
                    class="fr-message fr-message--info fr-mt-1v fr-mb-5v"
                  >
                    Préciser le nom de votre ville / de votre unité locale en
                    cas de réseau / de votre association
                  </li>
                  <li
                    *ngIf="(f.nom.dirty || submitted) && f.nom.errors"
                    id="nom-errors"
                    class="fr-message fr-message--error mt-0"
                  >
                    Le nom de la structure est requis
                  </li>
                </ul>
                <p
                  *ngIf="isInvalidStructureName(f.nom.value)"
                  id="nom-structure-description"
                  class="fr-message fr-message--error"
                >
                  <b
                    >Préciser le nom de votre ville / de votre unité locale en
                    cas de réseau / de votre association.</b
                  >
                </p>
              </div>
            </div>
          </div>

          <div class="row py-1">
            <div
              [class.fr-input-group--error]="
                (submitted || f.siret?.dirty) && f.siret?.errors
              "
              class="col-12 col-md-12 fr-input-group"
            >
              <label class="fr-label" for="siret">N° Siret</label>
              <input
                type="text"
                class="fr-input"
                id="siret"
                formControlName="siret"
                name="siret"
                placeholder="12345678901234"
                maxlength="14"
                pattern="[0-9]{14}"
                appDigitOnly
                [attr.aria-invalid]="
                  (submitted || f.siret?.dirty) && f.siret?.errors
                    ? true
                    : false
                "
                [attr.aria-describedby]="
                  (submitted || f.siret?.dirty) && f.siret?.errors
                    ? 'siret-errors'
                    : 'siret-description'
                "
              />
              <ul class="fr-messages-group ps-0">
                <li
                  id="siret-description"
                  class="fr-message fr-message--info mt-0"
                >
                  14 chiffres (Optionnel)
                </li>
                <li
                  id="siret-errors"
                  class="fr-message fr-message--error mt-0"
                  *ngIf="(submitted || f.siret?.dirty) && f.siret?.errors"
                >
                  {{ 
                    f.siret?.errors?.['invalidSiret'] 
                      ? 'Le format du numéro de SIRET est incorrect'
                      : 'Si vous n\'avez pas de n° SIRET veuillez cochez la case ci-dessous'
                  }}
                </li>
              </ul>
            </div>
          </div>
          <div class="row pt-1 pb-4">
            <div class="fr-checkbox-group">
              <input
                formControlName="noSiret"
                name="checkbox"
                id="noSiret"
                type="checkbox"
              />
              <label class="fr-label" for="noSiret">
                Je n’ai pas de numéro Siret
              </label>
              <div class="fr-messages-group" aria-live="polite"></div>
            </div>
          </div>
        </section>
        <!-- Informations sur l'agrément -->
        <section
          class="py-4 px-2 fr-background-alt--grey border-top border-bottom"
          *ngIf="f.structureType.value === 'asso'"
        >
          <div class="d-flex flex-column justify-content-center">
            <div class="d-flex gap-1 align-items-end my-1">
              <img
                class="fr-width-2-5rem"
                src="assets/dsfr-pictograms/buildings/companie.svg"
                aria-hidden="true"
                alt=""
              />
              <h2 class="m-0">Informations sur l'agrément</h2>
            </div>
          </div>
          <fieldset class="my-2">
            <legend class="visually-hidden">
              Informations sur l'agrément de votre organisme
            </legend>
            <div class="row">
              <div
                [class.fr-select-group--error]="
                  (submitted || f.departement.dirty) && f.departement.errors
                "
                class="col-12 col-md-6 fr-select-group required"
              >
                <label class="fr-label" for="departement"
                  >Préfecture ayant délivré l’agrément</label
                >
                <select
                  id="departement"
                  formControlName="departement"
                  name="departement"
                  [attr.aria-describedby]="
                    (submitted || f.departement.dirty) && f.departement.errors
                      ? 'departement-errors'
                      : null
                  "
                  [attr.aria-invalid]="
                    (submitted || f.departement.dirty) && f.departement.errors
                      ? true
                      : false
                  "
                  class="fr-select"
                  required
                >
                  <option [ngValue]="null"></option>
                  <option
                    *ngFor="let departement of DEPARTEMENTS_LISTE | keyvalue"
                    [ngValue]="departement.key"
                  >
                    {{ departement.key }} - {{ departement.value }}
                  </option>
                </select>
                <ul
                  class="fr-messages-group ps-0"
                  id="departement-errors"
                  *ngIf="
                    (submitted || f.departement.dirty) && f.departement.errors
                  "
                >
                  <li class="fr-message fr-message--error mt-0">
                    Veuillez sélectionner un département
                  </li>
                </ul>
              </div>

              <div
                [class.fr-input-group--error]="
                  (submitted || f.agrement.dirty) && f.agrement.errors
                "
                class="col-12 col-md-6 fr-input-group required"
              >
                <label class="fr-label" for="agrement">Numéro d'agrément</label>
                <input
                  formControlName="agrement"
                  name="agrement"
                  class="fr-input"
                  required
                  id="agrement"
                  type="text"
                  [attr.aria-invalid]="
                    (submitted || f.agrement.dirty) && f.agrement.errors
                      ? true
                      : false
                  "
                  [attr.aria-describedby]="
                    (submitted || f.agrement.dirty) && f.agrement.errors
                      ? 'agrement-errors'
                      : null
                  "
                />
                <ul
                  class="fr-messages-group ps-0"
                  id="agrement-errors"
                  *ngIf="(submitted || f.agrement.dirty) && f.agrement.errors"
                >
                  <li class="fr-message fr-message--error mt-0">
                    Veuillez insérer un numéro d'agrément
                  </li>
                </ul>
              </div>

              <div
                [class.fr-input-group--error]="
                  (submitted || f.capacite.dirty) && f.capacite.errors
                "
                class="col-12 col-md-6 fr-input-group"
              >
                <label class="fr-label" for="capacite"
                  >Capacité d'accueil</label
                >
                <input
                  formControlName="capacite"
                  name="capacite"
                  class="fr-input"
                  id="capacite"
                  min="0"
                  type="number"
                  [attr.aria-describedby]="
                    (submitted || f.capacite.dirty) && f.capacite.errors
                      ? 'capacite-errors'
                      : null
                  "
                  [attr.aria-invalid]="
                    (submitted || f.capacite.dirty) && f.capacite.errors
                      ? true
                      : false
                  "
                />

                <ul
                  class="fr-messages-group ps-0"
                  id="capacite-errors"
                  *ngIf="(submitted || f.capacite.dirty) && f.capacite.errors"
                >
                  <li class="fr-message fr-message--error mt-0">
                    La capacité doit être supérieure à 0
                  </li>
                </ul>
              </div>

              <div
                [class.fr-select-group--error]="
                  (submitted || f.organismeType?.dirty) &&
                  f.organismeType.errors
                "
                class="col-12 col-md-6 fr-select-group required"
              >
                <label class="fr-label" for="organismeType"
                  >Type d'organisme agréé</label
                >
                <select
                  id="organismeType"
                  formControlName="organismeType"
                  name="organismeType"
                  [attr.aria-describedby]="
                    (submitted || f.organismeType?.dirty) &&
                    f.organismeType.errors
                      ? 'organisme-type-errors'
                      : null
                  "
                  [attr.aria-invalid]="
                    (submitted || f.organismeType?.dirty) &&
                    f.organismeType.errors
                      ? true
                      : false
                  "
                  class="fr-select"
                  required
                >
                  <option [ngValue]="null"></option>
                  <option
                    *ngFor="
                      let organismeType of STRUCTURE_ORGANISME_TYPE_LABELS
                        | keyvalue
                    "
                    [ngValue]="organismeType.key"
                  >
                    {{ organismeType.value }}
                  </option>
                </select>
                <ul
                  class="fr-messages-group ps-0"
                  id="organisme-type-errors"
                  *ngIf="
                    (submitted || f.organismeType?.dirty) &&
                    f.organismeType.errors
                  "
                >
                  <li class="fr-message fr-message--error mt-0">
                    Veuillez sélectionner un département
                  </li>
                </ul>
              </div>
              <div
                [class.fr-select-group--error]="
                  (submitted || f.reseau?.dirty) && f.reseau.errors
                "
                class="col-12 col-md-12 fr-select-group"
              >
                <label class="fr-label" for="reseau">
                  Précisez votre réseau</label
                >
                <select
                  id="reseau"
                  formControlName="reseau"
                  name="reseau"
                  [attr.aria-describedby]="
                    (submitted || f.reseau?.dirty) && f.reseau.errors
                      ? 'reseau-type-errors'
                      : null
                  "
                  [attr.aria-invalid]="
                    (submitted || f.reseau?.dirty) && f.reseau.errors
                      ? true
                      : false
                  "
                  class="fr-select"
                >
                  <option [ngValue]="null">Non renseigné</option>
                  <option value="Pas de réseau">Pas de réseau</option>
                  <option value="Autre réseau">Autre réseau</option>
                  <option
                    *ngFor="let reseau of NETWORKS"
                    [ngValue]="reseau.canonicalName"
                  >
                    {{ reseau.canonicalName }}
                  </option>
                </select>
                <ul
                  class="fr-messages-group ps-0"
                  id="organisme-type-errors"
                  *ngIf="(submitted || f.reseau?.dirty) && f.reseau.errors"
                >
                  <li class="fr-message fr-message--error mt-0">
                    Veuillez sélectionner un type d'organisme
                  </li>
                </ul>
              </div>
              <div
                class="col-12"
                [ngClass]="{
                  'is-invalid': (submitted || dsp?.dirty) && dsp?.errors
                }"
              >
                <fieldset
                  id="dsp-fieldset"
                  class="fr-fieldset"
                  role="group"
                  [attr.aria-labelledby]="'dsp-legend'"
                  [attr.aria-describedby]="
                    (submitted || dsp?.dirty) && dsp?.errors
                      ? 'dsp-errors'
                      : null
                  "
                  [attr.aria-invalid]="
                    (submitted || dsp?.dirty) && dsp?.errors ? true : false
                  "
                  [class.fr-fieldset--error]="
                    (submitted || dsp?.dirty) && dsp?.errors
                  "
                >
                  <legend
                    id="dsp-legend"
                    class="fr-fieldset__legend--regular fr-fieldset__legend required"
                    [ngClass]="{
                      'is-invalid': (submitted || dsp?.dirty) && dsp?.errors
                    }"
                  >
                    Exercez-vous une délégation de Service Public
                  </legend>
                  <div
                    class="fr-fieldset__element fr-fieldset__element--inline"
                  >
                    <div class="fr-radio-group">
                      <input
                        type="radio"
                        id="dsp-oui"
                        formControlName="dsp"
                        name="dsp"
                        [value]="true"
                        [ngClass]="{
                          'is-invalid': (submitted || dsp?.dirty) && dsp?.errors
                        }"
                        [attr.aria-invalid]="
                          (submitted || dsp?.dirty) && dsp?.errors
                            ? true
                            : false
                        "
                        [attr.aria-describedby]="
                          (submitted || dsp?.dirty) && dsp?.errors
                            ? 'dsp-errors'
                            : 'dsp-legend'
                        "
                        [attr.required]="dsp?.errors ? true : null"
                      />
                      <label class="fr-label" for="dsp-oui">Oui</label>
                    </div>
                  </div>
                  <div
                    class="fr-fieldset__element fr-fieldset__element--inline"
                  >
                    <div class="fr-radio-group">
                      <input
                        type="radio"
                        id="dsp-non"
                        formControlName="dsp"
                        name="dsp"
                        [value]="false"
                        [ngClass]="{
                          'is-invalid': (submitted || dsp?.dirty) && dsp?.errors
                        }"
                        [attr.aria-invalid]="
                          (submitted || dsp?.dirty) && dsp?.errors
                            ? true
                            : false
                        "
                        [attr.aria-describedby]="
                          (submitted || dsp?.dirty) && dsp?.errors
                            ? 'dsp-errors'
                            : 'dsp-legend'
                        "
                        [attr.required]="dsp?.errors ? true : null"
                      />
                      <label class="fr-label" for="dsp-non">Non</label>
                    </div>
                  </div>

                  <ul
                    class="fr-messages-group ps-0"
                    id="dsp-errors"
                    *ngIf="(submitted || dsp?.dirty) && dsp?.errors"
                    role="alert"
                    aria-live="polite"
                    [attr.aria-atomic]="true"
                  >
                    <li class="fr-message fr-message--error mt-0">
                      Ce champ est requis
                    </li>
                  </ul>
                </fieldset>
              </div>
            </div>
          </fieldset>
        </section>
        <!-- Resposable légal -->
        <section>
          <div class="d-flex flex-column justify-content-center">
            <div class="d-flex gap-1 align-items-end my-1">
              <img
                class="fr-width-2-5rem"
                src="assets/dsfr-pictograms/digital/avatar.svg"
                aria-hidden="true"
                alt=""
              />
              <h2 class="m-0">Responsable légal</h2>
            </div>
            <p>Il s’agit du nom qui apparaîtra sur le Cerfa.</p>
          </div>
          <fieldset class="my-2">
            <div class="row" formGroupName="responsable">
              <div
                [class.fr-input-group--error]="
                  (submitted || f.responsable.get('nom')?.dirty) &&
                  f.responsable.get('nom')?.errors
                "
                class="col-12 col-md-4 fr-input-group required"
              >
                <label class="fr-label" for="responsable-nom">Nom</label>
                <input
                  type="text"
                  class="fr-input"
                  id="responsable-nom"
                  formControlName="nom"
                  name="nom"
                  autocomplete="family-name"
                  [attr.aria-describedby]="
                    (submitted || f.responsable.get('nom')?.dirty) &&
                    f.responsable.get('nom')?.errors
                      ? 'responsable-nom-errors'
                      : null
                  "
                  [attr.aria-invalid]="
                    (submitted || f.responsable.get('nom')?.dirty) &&
                    f.responsable.get('nom')?.errors
                      ? true
                      : false
                  "
                  required
                />
                <ul
                  class="fr-messages-group ps-0"
                  id="responsable-nom-errors"
                  *ngIf="
                    (submitted || f.responsable.get('nom')?.dirty) &&
                    f.responsable.get('nom')?.errors
                  "
                >
                  <li class="fr-message fr-message--error mt-0">
                    Le nom du responsable est obligatoire
                  </li>
                </ul>
              </div>
              <div
                [class.fr-input-group--error]="
                  (submitted || f.responsable.get('prenom')?.dirty) &&
                  f.responsable.get('prenom')?.errors
                "
                class="col-12 col-md-4 fr-input-group required"
              >
                <label class="fr-label" for="responsable-prenom"
                  >Prénom(s)</label
                >
                <input
                  type="text"
                  class="fr-input"
                  id="responsable-prenom"
                  formControlName="prenom"
                  name="prenom"
                  autocomplete="given-name"
                  [attr.aria-invalid]="
                    (submitted || f.responsable.get('prenom')?.dirty) &&
                    f.responsable.get('prenom')?.errors
                      ? true
                      : false
                  "
                  [attr.aria-describedby]="
                    (submitted || f.responsable.get('prenom')?.dirty) &&
                    f.responsable.get('prenom')?.errors
                      ? 'responsable-prenom-errors'
                      : null
                  "
                  required
                />
                <ul
                  class="fr-messages-group ps-0"
                  id="responsable-prenom-errors"
                  *ngIf="
                    (submitted || f.responsable.get('prenom')?.dirty) &&
                    f.responsable.get('prenom')?.errors
                  "
                >
                  <li class="fr-message fr-message--error mt-0">
                    Le prénom du responsable est obligatoire
                  </li>
                </ul>
              </div>
              <div
                [class.fr-input-group--error]="
                  (submitted || f.responsable.get('fonction')?.dirty) &&
                  f.responsable.get('fonction')?.errors
                "
                class="col-12 col-md-4 fr-input-group required"
              >
                <label class="fr-label" for="fonction">Fonction</label>
                <input
                  type="text"
                  class="fr-input"
                  id="fonction"
                  formControlName="fonction"
                  name="fonction"
                  autocomplete="organization-title"
                  [attr.aria-invalid]="
                    (submitted || f.responsable.get('fonction')?.dirty) &&
                    f.responsable.get('fonction')?.errors
                      ? true
                      : false
                  "
                  [attr.aria-describedby]="
                    (submitted || f.responsable.get('fonction')?.dirty) &&
                    f.responsable.get('fonction')?.errors
                      ? 'responsable-fonction-errors'
                      : 'responsable-fonction-description'
                  "
                  required
                />
                <small id=""></small>
                <ul class="fr-messages-group ps-0" id="">
                  <li
                    *ngIf="
                      !(
                        (submitted || f.responsable.get('fonction')?.dirty) &&
                        f.responsable.get('fonction')?.errors
                      )
                    "
                    id="responsable-fonction-description"
                    class="fr-message fr-message--info mt-0"
                  >
                    Président.e, Directrice, etc.
                  </li>
                  <li
                    *ngIf="
                      (submitted || f.responsable.get('fonction')?.dirty) &&
                      f.responsable.get('fonction')?.errors
                    "
                    id="responsable-fonction-errors"
                    class="fr-message fr-message--error mt-0"
                  >
                    La fonction du responsable est obligatoire
                  </li>
                </ul>
              </div>
            </div>
          </fieldset>
        </section>
        <hr />
        <!-- Adresse -->
        <section>
          <div class="d-flex flex-column justify-content-center">
            <div class="d-flex gap-1 align-items-end my-1">
              <img
                class="fr-width-2-5rem"
                src="assets/dsfr-pictograms/map/map-pin.svg"
                aria-hidden="true"
                alt=""
              />
              <h2 class="m-0">Adresse</h2>
            </div>
            <p class="fw-bold">
              Précisez le nom de votre ville / de votre unité locale en cas de
              réseau / de votre association. <br />
              <small class="text-xs"
                >Ex : CCAS du Havre / Croix Rouge de Paris / Association Aurore
              </small>
            </p>
          </div>
          <fieldset>
            <legend class="visually-hidden">
              Adresse complète de la structure
            </legend>
            <div class="row">
              <div
                [class.fr-input-group--error]="
                  (f.adresse.dirty || submitted) && f.adresse.errors
                "
                class="col-12 col-md-12 fr-input-group required"
              >
                <label class="fr-label" for="adresse"
                  >Adresse de l'organisme domiciliataire</label
                >
                <input
                  id="adresse"
                  type="text"
                  class="fr-input"
                  formControlName="adresse"
                  name="adresse"
                  autcomplete="street-address"
                  [attr.aria-invalid]="
                    (f.adresse.dirty || submitted) && f.adresse.errors
                      ? true
                      : false
                  "
                  [attr.aria-describedby]="
                    (f.adresse.dirty || submitted) && f.adresse.errors
                      ? 'address-errors'
                      : 'address-description'
                  "
                  required
                />
                <small id="address-description"
                  >Cette adresse apparaîtra sur le Cerfa</small
                >
                <ul
                  class="fr-messages-group ps-0"
                  id="address-errors"
                  *ngIf="submitted && f.adresse.errors"
                >
                  <li class="fr-message fr-message--error mt-0">
                    L'adresse est obligatoire
                  </li>
                </ul>
              </div>

              <div
                [class.fr-input-group--error]="
                  (f.complementAdresse.dirty || submitted) &&
                  f.complementAdresse.errors
                "
                class="col-md-12 fr-input-group"
              >
                <label class="fr-label" for="complementAdresse"
                  >Complément d'adresse</label
                >
                <input
                  type="text"
                  class="fr-input"
                  id="complementAdresse"
                  formControlName="complementAdresse"
                  name="complementAdresse"
                  [attr.aria-describedby]="
                    (f.complementAdresse.dirty || submitted) &&
                    f.complementAdresse.errors
                      ? 'complement-errors'
                      : 'complement-description'
                  "
                  [attr.aria-invalid]="
                    (f.complementAdresse.dirty || submitted) &&
                    f.complementAdresse.errors
                      ? true
                      : false
                  "
                />
                <small id="complement-description"
                  >Lieu-dit, Bâtiment, étage, etc..</small
                >
                <ul
                  class="fr-messages-group ps-0"
                  id="complement-errors"
                  *ngIf="submitted && f.complementAdresse.errors"
                >
                  <li class="fr-message fr-message--error mt-0">
                    Veuillez vérifier le complément d'adresse
                  </li>
                </ul>
              </div>
              <div
                [class.fr-input-group--error]="
                  (f.codePostal.dirty || submitted) && f.codePostal.errors
                "
                class="col-12 col-md-6 fr-input-group required"
              >
                <label class="fr-label" for="codePostal">Code postal</label>
                <input
                  type="text"
                  class="fr-input"
                  id="codePostal"
                  maxlength="5"
                  formControlName="codePostal"
                  name="codePostal"
                  [attr.aria-describedby]="
                    (f.codePostal.dirty || submitted) && f.codePostal.errors
                      ? 'code-postal-errors'
                      : null
                  "
                  [attr.aria-invalid]="
                    (f.codePostal.dirty || submitted) && f.codePostal.errors
                      ? true
                      : false
                  "
                  required
                />
                <ul
                  class="fr-messages-group ps-0"
                  id="code-postal-errors"
                  *ngIf="f.codePostal.errors"
                >
                  <li class="fr-message fr-message--error mt-0">
                    Le code postal est obligatoire (Exemple: 75001)
                  </li>
                </ul>
              </div>
              <div
                [class.fr-input-group--error]="
                  (f.ville.dirty || submitted) && f.ville.errors
                "
                class="col-12 col-md-6 fr-input-group mb-4 required"
              >
                <label class="fr-label" for="ville">Ville</label>
                <input
                  type="text"
                  class="fr-input"
                  id="ville"
                  formControlName="ville"
                  name="ville"
                  required
                  [attr.aria-describedby]="
                    (f.ville.dirty || submitted) && f.ville.errors
                      ? 'ville-errors'
                      : null
                  "
                  [attr.aria-invalid]="
                    (f.ville.dirty || submitted) && f.ville.errors
                      ? true
                      : false
                  "
                />
                <ul
                  class="fr-messages-group ps-0"
                  id="ville-errors"
                  *ngIf="(f.ville.dirty || submitted) && f.ville.errors"
                >
                  <li class="fr-message fr-message--error mt-0">
                    La ville est obligatoire
                  </li>
                </ul>
              </div>
            </div>
          </fieldset>
          <div formGroupName="adresseCourrier">
            <div class="row">
              <div class="col-md-12">
                <div class="form-check fr-checkbox-group ps-0">
                  <input
                    type="checkbox"
                    formControlName="actif"
                    name="actif"
                    value="true"
                    id="adresseCourrier"
                  />
                  <label class="fr-label" for="adresseCourrier">
                    L'adresse de réception du courrier est différente de celle
                    de l'organisme domiciliataire ?
                  </label>
                </div>
              </div>
            </div>

            <fieldset
              *ngIf="f.adresseCourrier.get('actif')?.value === true"
              class="my-2"
            >
              <legend class="visually-hidden">
                Informations sur l'adresse de réception du courrier
              </legend>
              <div class="row">
                <div
                  [class.fr-input-group--error]="
                    (submitted || f.adresseCourrier.get('adresse')?.dirty) &&
                    f.adresseCourrier.get('adresse')?.errors
                  "
                  class="col-12 col-md-12 fr-input-group required"
                >
                  <label class="fr-label" for="adresse2"
                    >Adresse de réception du courrier</label
                  >
                  <input
                    type="text"
                    class="fr-input"
                    id="adresse2"
                    formControlName="adresse"
                    name="adresse"
                    autcomplete="street-address"
                    [attr.aria-describedby]="
                      (submitted || f.adresseCourrier.get('adresse')?.dirty) &&
                      f.adresseCourrier.get('adresse')?.errors
                        ? 'adresse-reception-errors'
                        : null
                    "
                    [attr.aria-invalid]="
                      (submitted || f.adresseCourrier.get('adresse')?.dirty) &&
                      f.adresseCourrier.get('adresse')?.errors
                        ? true
                        : false
                    "
                    required
                  />
                  <ul
                    class="fr-messages-group ps-0"
                    id="adresse-reception-errors"
                    *ngIf="
                      (submitted || f.adresseCourrier.get('adresse')?.dirty) &&
                      f.adresseCourrier.get('adresse')?.errors
                    "
                  >
                    <li class="fr-message fr-message--error mt-0">
                      L'adresse de réception est obligatoire
                    </li>
                  </ul>
                </div>
                <div
                  [class.fr-input-group--error]="
                    (submitted || f.adresseCourrier.get('codePostal')?.dirty) &&
                    f.adresseCourrier.get('codePostal')?.errors
                  "
                  class="col-12 col-md-6 fr-input-group required"
                >
                  <label class="fr-label" for="codePostal2">Code postal</label>
                  <input
                    type="text"
                    class="fr-input"
                    id="codePostal2"
                    maxlength="5"
                    formControlName="codePostal"
                    name="codePostal"
                    [attr.aria-describedby]="
                      (submitted ||
                        f.adresseCourrier.get('codePostal')?.dirty) &&
                      f.adresseCourrier.get('codePostal')?.errors
                        ? 'code-postal-reception-errors'
                        : null
                    "
                    [attr.aria-invalid]="
                      (submitted ||
                        f.adresseCourrier.get('codePostal')?.dirty) &&
                      f.adresseCourrier.get('codePostal')?.errors
                        ? true
                        : false
                    "
                    required
                  />
                  <ul
                    class="fr-messages-group ps-0"
                    id="code-postal-reception-errors"
                    *ngIf="
                      (submitted ||
                        f.adresseCourrier.get('codePostal')?.dirty) &&
                      f.adresseCourrier.get('codePostal')?.errors
                    "
                  >
                    <li class="fr-message fr-message--error mt-0">
                      Le code postal est obligatoire (Exemple: 75001)
                    </li>
                  </ul>
                </div>
                <div
                  [class.fr-input-group--error]="
                    (submitted || f.adresseCourrier.get('ville')?.dirty) &&
                    f.adresseCourrier.get('ville')?.errors
                  "
                  class="col-12 col-md-6 fr-input-group required"
                >
                  <label class="fr-label" for="ville2">Ville</label>
                  <input
                    type="text"
                    class="fr-input"
                    id="ville2"
                    formControlName="ville"
                    name="ville"
                    [attr.aria-describedby]="
                      (submitted || f.adresseCourrier.get('ville')?.dirty) &&
                      f.adresseCourrier.get('ville')?.errors
                        ? 'ville-reception-errors'
                        : null
                    "
                    [attr.aria-invalid]="
                      (submitted || f.adresseCourrier.get('ville')?.dirty) &&
                      f.adresseCourrier.get('ville')?.errors
                        ? true
                        : false
                    "
                    required
                  />
                  <ul
                    class="fr-messages-group ps-0"
                    id="ville-reception-errors"
                    *ngIf="
                      (submitted || f.adresseCourrier.get('ville')?.dirty) &&
                      f.adresseCourrier.get('ville')?.errors
                    "
                  >
                    <li class="fr-message fr-message--error mt-0">
                      La ville est obligatoire
                    </li>
                  </ul>
                </div>
              </div>
            </fieldset>
          </div>
        </section>
        <hr class="mt-2" />
        <!-- Contact -->
        <section>
          <div class="d-flex flex-column justify-content-center">
            <div class="d-flex gap-1 align-items-end mb-3">
              <img
                class="fr-width-2-5rem"
                src="assets/dsfr-pictograms/digital/mail-send.svg"
                aria-hidden="true"
                alt=""
              />
              <h2 class="m-0">Contact</h2>
            </div>
          </div>
          <div role="notice" class="fr-notice fr-notice--info mb-4">
            <div class="fr-container">
              <div class="fr-notice__body">
                <p>
                  <span class="fr-notice__title">Information</span>
                  <span class="fr-notice__desc">
                    Pour des raisons de sécurité, les adresses emails génériques
                    (ex. : contact{{ "@" }}, domiciliation{{ "@" }} admin{{
                      "@"
                    }}, etc.) ne sont pas autorisées lors de l’inscription.
                    Merci d’utiliser une adresse email nominative (ex. :
                    prenom.nom{{ "@" }}votredomaine.com). Sans cela, votre
                    demande d’inscription pourrait ne pas être validée.</span
                  >
                </p>
              </div>
            </div>
          </div>
          <fieldset class="my-2">
            <legend class="visually-hidden">
              Informations de contact de la structure
            </legend>

            <div class="row">
              <div
                [class.fr-input-group--error]="
                  submitted && (f.telephone.errors || f.telephone.invalid)
                "
                class="col-md-6 col-12 fr-input-group required"
              >
                <label class="fr-label" for="phone">Numéro de téléphone</label>
                <ngx-intl-tel-input
                  cssClass="fr-input"
                  [preferredCountries]="PREFERRED_COUNTRIES"
                  [enableAutoCountrySelect]="false"
                  [enablePlaceholder]="true"
                  [searchCountryFlag]="true"
                  searchCountryPlaceholder="Choisissez votre pays"
                  [searchCountryField]="[
                    SearchCountryField.Iso2,
                    SearchCountryField.Name
                  ]"
                  [selectedCountryISO]="CountryISO.France"
                  [selectFirstCountry]="true"
                  [maxLength]="15"
                  [phoneValidation]="true"
                  [separateDialCode]="true"
                  [onlyCountries]="PREFERRED_COUNTRIES"
                  [inputId]="'phone'"
                  [numberFormat]="PhoneNumberFormat.International"
                  formControlName="telephone"
                  name="telephone"
                ></ngx-intl-tel-input>
                <ul
                  class="fr-messages-group ps-0"
                  *ngIf="
                    submitted && (f.telephone.errors || f.telephone.invalid)
                  "
                >
                  <li class="fr-message fr-message--error mt-0">
                    Veuillez vérifier le numéro de téléphone. Ex: 0101010101
                  </li>
                </ul>
              </div>
              <div
                [class.fr-input-group--error]="
                  (submitted || f.email.dirty) && f.email.errors
                "
                class="col-md-6 col-12 mb-4 fr-input-group required"
              >
                <label class="fr-label" for="email">E-mail</label>
                <input
                  type="email"
                  id="email"
                  formControlName="email"
                  name="email"
                  autocomplete="email"
                  class="fr-input"
                  [attr.aria-invalid]="
                    (submitted || f.email.dirty) && f.email.errors
                      ? true
                      : false
                  "
                  [attr.aria-describedby]="
                    (submitted || f.email.dirty) && f.email.errors
                      ? 'email-errors'
                      : 'email-hint'
                  "
                  required
                />
                <ul class="fr-messages-group ps-0">
                  <li
                    id="email-hint"
                    *ngIf="!((submitted || f.email.dirty) && f.email.errors)"
                    class="fr-message fr-message--info"
                  >
                    Adresse e-mail indiquée sur le Cerfa
                  </li>
                  <li
                    id="email-errors"
                    *ngIf="(submitted || f.email.dirty) && f.email.errors"
                    class="fr-message fr-message--error mt-0"
                  >
                    Veuillez vérifier l'adresse email, format attendu :
                    nom&#64;domaine.fr
                  </li>
                </ul>
              </div>
            </div>
          </fieldset>
        </section>
        <hr />
        <!-- Informations sur votre activité -->
        <section>
          <div class="d-flex flex-column justify-content-center">
            <div class="d-flex gap-1 align-items-end my-1">
              <img
                class="fr-width-2-5rem"
                src="assets/dsfr-pictograms/system/information.svg"
                aria-hidden="true"
                alt=""
              />
              <h2 class="m-0">Informations sur votre activité</h2>
            </div>
            <p>Ces informations nous aident à mieux comprendre vos besoins</p>
          </div>
          <fieldset class="mb-4" formGroupName="registrationData">
            <legend class="visually-hidden">
              Données d'inscription et informations sur l'activité
            </legend>

            <div class="row py-2">
              <div
                [class.fr-select-group--error]="
                  (submitted || reg.source?.dirty) && reg.source?.errors
                "
                class="col-12 fr-select-group required"
              >
                <label class="fr-label" for="source">
                  Comment avez-vous entendu parler de DomiFa ?
                </label>
                <select
                  class="fr-select"
                  id="source"
                  formControlName="source"
                  name="source"
                  [attr.aria-invalid]="
                    (submitted || reg.source?.dirty) && reg.source?.errors
                      ? true
                      : false
                  "
                  [attr.aria-describedby]="
                    (submitted || reg.source?.dirty) && reg.source?.errors
                      ? 'source-errors'
                      : null
                  "
                  required
                >
                  <option [ngValue]="null">Sélectionnez une option</option>
                  <option
                    *ngFor="let option of SOURCES_OPTIONS"
                    [value]="option.value"
                  >
                    {{ option.label }}
                  </option>
                </select>

                <ul
                  class="fr-messages-group ps-0"
                  id="source-errors"
                  *ngIf="(submitted || reg.source?.dirty) && reg.source?.errors"
                >
                  <li class="fr-message fr-message--error mt-0">
                    Veuillez sélectionner une option
                  </li>
                </ul>
              </div>
              <div
                [class.fr-input-group--error]="
                  (submitted || reg.sourceDetail?.dirty) &&
                  reg.sourceDetail?.errors
                "
                *ngIf="showsourceDetail"
                class="col-12 fr-input-group required"
              >
                <label class="fr-label" for="sourceDetail"> Précisez : </label>
                <input
                  type="text"
                  class="fr-input"
                  id="sourceDetail"
                  formControlName="sourceDetail"
                  required
                />
                <ul
                  class="fr-messages-group ps-0"
                  *ngIf="
                    (submitted || reg.sourceDetail?.dirty) &&
                    reg.sourceDetail?.errors
                  "
                >
                  <li class="fr-message fr-message--error mt-0">
                    Ce champ est requis
                  </li>
                </ul>
              </div>
            </div>

            <div class="row py-2">
              <div
                [class.fr-input-group--error]="
                  (submitted || reg.currentTool?.dirty) &&
                  reg.currentTool?.errors
                "
                class="col-12 fr-input-group required"
              >
                <label class="fr-label" for="currentTool">
                  Comment gérez-vous actuellement la domiciliation ?
                </label>
                <select
                  class="fr-input form-select"
                  id="currentTool"
                  formControlName="currentTool"
                  name="currentTool"
                  [attr.aria-invalid]="
                    (submitted || reg.currentTool?.dirty) &&
                    reg.currentTool?.errors
                      ? true
                      : false
                  "
                  [attr.aria-describedby]="
                    (submitted || reg.currentTool?.dirty) &&
                    reg.currentTool?.errors
                      ? 'currentTool-errors'
                      : null
                  "
                  required
                >
                  <option [ngValue]="null">Sélectionnez une option</option>
                  <option
                    *ngFor="let option of CURRENT_TOOL_OPTIONS"
                    [value]="option.value"
                  >
                    {{ option.label }}
                  </option>
                </select>

                <ul
                  class="fr-messages-group ps-0"
                  id="currentTool-errors"
                  *ngIf="
                    (submitted || reg.currentTool?.dirty) &&
                    reg.currentTool?.errors
                  "
                  role="alert"
                  aria-live="polite"
                >
                  <li class="fr-message fr-message--error mt-0">
                    Veuillez sélectionner une option
                  </li>
                </ul>
              </div>

              <div
                [class.fr-input-group--error]="
                  (submitted || reg.marketTool?.dirty) && reg.marketTool?.errors
                "
                class="col-6 fr-input-group required"
                *ngIf="reg.currentTool?.value === 'OUTIL_MARCHE'"
              >
                <label class="fr-label" for="marketTool">
                  Quel outil du marché utilisez-vous ?
                </label>
                <select
                  class="fr-select"
                  id="marketTool"
                  formControlName="marketTool"
                  name="marketTool"
                  [attr.aria-invalid]="
                    (submitted || reg.marketTool?.dirty) &&
                    reg.marketTool?.errors
                      ? true
                      : false
                  "
                  [attr.aria-describedby]="
                    (submitted || reg.marketTool?.dirty) &&
                    reg.marketTool?.errors
                      ? 'marketTool-errors'
                      : null
                  "
                  required
                >
                  <option [ngValue]="null">Sélectionnez une option</option>
                  <option
                    *ngFor="let option of MARKET_TOOLS_OPTIONS"
                    [value]="option.value"
                  >
                    {{ option.label }}
                  </option>
                </select>

                <ul
                  class="fr-messages-group ps-0"
                  id="marketTool-errors"
                  *ngIf="
                    (submitted || reg.marketTool?.dirty) &&
                    reg.marketTool?.errors
                  "
                  role="alert"
                  aria-live="polite"
                >
                  <li class="fr-message fr-message--error mt-0">
                    Veuillez sélectionner une option
                  </li>
                </ul>
              </div>

              <div
                [class.fr-input-group--error]="
                  (submitted || reg.marketToolOther?.dirty) &&
                  reg.marketToolOther?.errors
                "
                class="col-6 fr-input-group required"
                *ngIf="
                  reg.currentTool?.value === 'OUTIL_MARCHE' &&
                  reg.marketTool?.value === 'AUTRE'
                "
              >
                <label class="fr-label" for="marketToolOther">
                  Précisez l'outil :
                </label>
                <input
                  type="text"
                  class="fr-input"
                  id="marketToolOther"
                  formControlName="marketToolOther"
                  name="marketToolOther"
                  placeholder="Nom de l'outil"
                  [attr.aria-invalid]="
                    (submitted || reg.marketToolOther?.dirty) &&
                    reg.marketToolOther?.errors
                      ? true
                      : false
                  "
                  [attr.aria-describedby]="
                    (submitted || reg.marketToolOther?.dirty) &&
                    reg.marketToolOther?.errors
                      ? 'marketToolOther-errors'
                      : null
                  "
                  required
                />

                <ul
                  class="fr-messages-group ps-0"
                  id="marketToolOther-errors"
                  *ngIf="
                    (submitted || reg.marketToolOther?.dirty) &&
                    reg.marketToolOther?.errors
                  "
                  role="alert"
                  aria-live="polite"
                >
                  <li class="fr-message fr-message--error mt-0">
                    Ce champ est requis
                  </li>
                </ul>
              </div>
            </div>
            <div class="row py-2">
              <div
                [class.fr-input-group--error]="
                  (submitted || reg.activeUsersCount?.dirty) &&
                  reg.activeUsersCount?.errors
                "
                class="col-12 col-md-12 fr-input-group required"
              >
                <label class="fr-label" for="activeUsersCount"
                  >Nombre de domiciliés à date</label
                >
                <input
                  formControlName="activeUsersCount"
                  name="activeUsersCount"
                  class="fr-input"
                  id="activeUsersCount"
                  min="0"
                  type="number"
                  required
                  [attr.aria-describedby]="
                    (submitted || reg.activeUsersCount?.dirty) &&
                    reg.activeUsersCount?.errors
                      ? 'activeUsersCount-errors'
                      : null
                  "
                  [attr.aria-invalid]="
                    (submitted || reg.activeUsersCount?.dirty) &&
                    reg.activeUsersCount?.errors
                      ? true
                      : false
                  "
                />

                <ul
                  class="fr-messages-group ps-0"
                  id="activeUsersCount-errors"
                  *ngIf="
                    (submitted || reg.activeUsersCount.dirty) &&
                    reg.activeUsersCount.errors
                  "
                >
                  <li class="fr-message fr-message--error mt-0">
                    Le nombre de domicilié est obligatoire
                  </li>
                </ul>
              </div>
            </div>
          </fieldset>
        </section>
        <hr />
        <!-- Conditions générales d'utilisation de DomiFa -->
        <section>
          <fieldset class="my-2">
            <legend>Conditions générales d'utilisation de DomiFa</legend>

            <div class="row">
              <div class="col-md-12 required">
                <div class="fr-checkbox-group ps-0">
                  <input
                    type="checkbox"
                    formControlName="acceptCgu"
                    name="acceptCgu"
                    class="form-check-input me-2"
                    [ngClass]="{
                      'is-invalid': submitted && f.acceptCgu?.errors
                    }"
                    [attr.aria-describedby]="
                      submitted && f.acceptCgu.errors
                        ? 'invalid-cgu-read'
                        : null
                    "
                    id="acceptCgu"
                    required
                  />
                  <label class="fr-label gap-1" for="acceptCgu"
                    >Je confirme que le responsable de la structure a lu et
                    accepté les

                    <a routerLink="/cgu" target="_blank">CGU</a></label
                  >
                </div>

                <ul
                  class="fr-messages-group ps-0"
                  id="invalid-cgu-read"
                  *ngIf="submitted && f.acceptCgu?.errors"
                >
                  <li class="fr-message fr-message--error mt-0">
                    Vous devez accepter les CGU afin de poursuivre l'inscription
                  </li>
                </ul>
              </div>
            </div>
          </fieldset>
        </section>
        <!-- Submit -->
        <section>
          <div class="my-3 d-flex justify-content-end">
            <button
              type="submit"
              [disabled]="loading"
              [attr.aria-busy]="loading"
              class="fr-btn"
            >
              <span *ngIf="loading">
                <fa-icon
                  aria-hidden="true"
                  [icon]="['fas', 'circle-notch']"
                  animation="spin"
                >
                </fa-icon>
                Veuillez patienter...
              </span>
              <span *ngIf="!loading"> Continuer</span>
            </button>
          </div>
        </section>
      </form>
    </div>

    <div
      class="fr-background-default--grey py-2 px-4"
      *ngIf="structureRegisterInfos.etapeInscription === 1"
    >
      <app-register-user
        (registerSuccess)="showRegisterSuccess = $event"
        [structureRegisterInfos]="structureRegisterInfos"
      ></app-register-user>
    </div>
  </div>
</div>
