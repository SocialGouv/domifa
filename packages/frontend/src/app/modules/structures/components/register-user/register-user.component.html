<div *ngIf="structureRegisterInfos">
  <div *ngIf="!success">
    <div>
      <div class="d-flex gap-1 align-items-end my-1">
        <!-- create custom class for picto width-->
        <img
          style="width: 3rem"
          src="assets/dsfr-pictograms/digital/avatar.svg"
          aria-hidden="true"
          alt=""
        />
        <h2 class="m-0">Création de votre compte administrateur</h2>
      </div>
      <p class="mb-0">
        <span class="fw-bold">Attention</span>, les informations que vous allez
        renseigner sont essentielles pour gérer votre compte administrateur
        Domifa. Une fois la validation effectuée, vous pourrez inviter d'autres
        collaborateurs à créer leurs comptes.
      </p>
    </div>
    <br />
    <form
      *ngIf="user && userForm"
      [formGroup]="userForm"
      (ngSubmit)="submitUser()"
    >
      <div class="row align-items-start">
        <div
          [class.fr-input-group--error]="
            (f.nom.dirty || submitted) && f.nom.errors
          "
          [class.fr-input-group--valid]="f.nom.dirty && !f.nom.errors"
          class="col fr-input-group required"
        >
          <label class="fr-label" for="nom">Nom</label>
          <input
            type="text"
            class="fr-input"
            id="nom"
            appCleanStr
            autocomplete="family-name"
            formControlName="nom"
            maxlength="200"
            name="nom"
            [attr.aria-describedby]="
              (f.nom.dirty || submitted) && f.nom.errors ? 'invalid-name' : null
            "
            [attr.aria-invalid]="
              (f.nom.dirty || submitted) && f.nom.errors ? true : false
            "
            required
          />
          <ul class="fr-messages-group ps-0">
            <li
              id="invalid-name"
              *ngIf="(f.nom.dirty || submitted) && f.nom.errors"
              class="fr-message fr-message--error mt-0"
            >
              Veuillez vérifier le nom
            </li>
          </ul>
        </div>
        <div
          [class.fr-input-group--valid]="f.prenom.dirty && !f.prenom.errors"
          [class.fr-input-group--error]="
            (submitted || f.prenom.dirty) && f.prenom.errors
          "
          class="col fr-input-group required"
        >
          <label class="fr-label" for="prenom">Prénom</label>
          <input
            type="text"
            class="fr-input"
            id="prenom"
            appCleanStr
            autocomplete="given-name"
            formControlName="prenom"
            maxlength="200"
            name="prenom"
            [attr.aria-describedby]="
              (submitted || f.prenom.dirty) && f.prenom.errors
                ? 'invalid-prenom'
                : null
            "
            [attr.aria-invalid]="
              (submitted || f.prenom.dirty) && f.prenom.errors ? true : false
            "
            required
          />
          <ul
            class="fr-messages-group ps-0"
            id="invalid-prenom"
            *ngIf="(submitted || f.prenom.dirty) && f.prenom.errors"
          >
            <li class="fr-message fr-message--error mt-0">
              Veuillez vérifier le prénom
            </li>
          </ul>
        </div>
      </div>
      <div class="row">
        <div class="col fr-input-group required">
          <app-fonction-selection
            [parentFormGroup]="userForm"
            [fonctionFormControl]="fonctionControl"
            [fonctionDetailFormControl]="fonctionDetailControl"
            [submitted]="submitted"
            invalidFeedbackText="La fonction du responsable est obligatoire"
          ></app-fonction-selection>
        </div>
      </div>
      <hr class="mt-4" />
      <div class="d-flex gap-1 align-items-end my-1">
        <!-- create custom class for picto width-->
        <img
          style="width: 2.5rem"
          src="assets/dsfr-pictograms/system/padlock.svg"
          aria-hidden="true"
          alt=""
        />
        <h2 class="m-0">Création du mot de passe</h2>
      </div>
      <div role="notice" class="fr-notice fr-notice--info mb-4">
        <div class="fr-container">
          <div class="fr-notice__body">
            <p>
              <span class="fr-notice__title">Information</span>
              <span class="fr-notice__desc">
                Pour des raisons de sécurité, les adresses emails génériques
                (ex. : contact{{ "@" }}, domiciliation{{ "@" }} admin{{ "@" }},
                etc.) ne sont pas autorisées lors de l’inscription. Merci
                d’utiliser une adresse email nominative (ex. : prenom.nom{{
                  "@"
                }}votredomaine.com). Sans cela, votre demande d’inscription
                pourrait ne pas être validée.</span
              >
            </p>
          </div>
        </div>
      </div>
      <div class="row">
        <div
          [class.fr-input-group--error]="
            (f.email.dirty || submitted) && f.email.errors
          "
          class="col-md-12 fr-input-group"
        >
          <label class="fr-label" for="email"
            >E-mail <span class="fr-text-default--error">*</span>
            <span class="fr-hint-text"
              >format attendu : nom{{ "@" }}domaine.fr</span
            ></label
          >
          <input
            type="email"
            class="fr-input"
            id="email"
            formControlName="email"
            name="email"
            [attr.aria-describedby]="
              (f.email.dirty || submitted) && f.email.errors
                ? 'email-errors'
                : 'email-description'
            "
            [attr.aria-invalid]="
              (f.email.dirty || submitted) && f.email.errors ? true : false
            "
            required
          />
          <ul class="fr-messages-group ps-0">
            <li
              id="email-description"
              *ngIf="!((f.email.dirty || submitted) && f.email.errors)"
              class="fr-message fr-message--info mt-0"
            >
              Adresse e-mail indiquée sur le Cerfa
            </li>
            <li
              id="email-errors"
              *ngIf="(f.email.dirty || submitted) && f.email.errors"
              class="fr-message fr-message--error mt-0"
            >
              Adresse e-mail indiquée sur le Cerfa
            </li>
          </ul>
        </div>
      </div>
      <div class="row">
        <app-user-structure-password-form
          [parentFormGroup]="userForm"
          [submitted]="submitted"
        ></app-user-structure-password-form>
      </div>
      <br />
      <ul
        class="fr-btns-group fr-btns-group--right fr-btns-group--inline-reverse fr-btns-group--inline-lg fr-btns-group--icon-left"
      >
        <li>
          <button
            type="submit"
            [disabled]="loading"
            [attr.aria-busy]="loading"
            class="fr-btn"
          >
            <span *ngIf="loading">
              <fa-icon
                [icon]="['fas', 'circle-notch']"
                animation="spin"
                aria-hidden="true"
              >
              </fa-icon>
              Veuillez patienter...
            </span>
            <span *ngIf="!loading"> Créer mon compte</span>
          </button>
        </li>
        <li>
          <a
            routerLink="/structures/inscription"
            class="fr-btn fr-btn--secondary"
          >
            Précédent
          </a>
        </li>
      </ul>
    </form>
  </div>
</div>
