<dsfr-modal
  [size]="'LG'"
  #registerModal
  dialogId="register-user-modal"
  titleModal="Créer un utilisateur"
>
  <p class="fr-text--sm fr-mb-2w">
    Les champs suivis d'un
    <span class="fr-text--bold">*</span> sont obligatoires
  </p>

  <form #form [formGroup]="userForm" (ngSubmit)="submitUser()">
    <div class="fr-grid-row fr-grid-row--gutters">
      <!-- Nom -->
      <div class="fr-col-12 fr-col-md-6">
        <div
          class="fr-input-group"
          [class.fr-input-group--error]="
            (f.nom.dirty || submitted) && f.nom.errors
          "
        >
          <label class="fr-label" for="nom"> Nom </label>
          <input
            class="fr-input"
            [class.fr-input--error]="(f.nom.dirty || submitted) && f.nom.errors"
            type="text"
            id="nom"
            name="nom"
            appCleanStr
            formControlName="nom"
            [attr.aria-describedby]="
              (f.nom.dirty || submitted) && f.nom.errors ? 'nom-messages' : null
            "
            [attr.aria-invalid]="
              (f.nom.dirty || submitted) && f.nom.errors ? true : false
            "
            required
          />
          <div class="fr-messages-group" id="nom-messages" aria-live="polite">
            @if ((f.nom.dirty || submitted) && f.nom.errors) {
            <p class="fr-message fr-message--error">Veuillez vérifier le nom</p>
            }
          </div>
        </div>
      </div>

      <!-- Prénom -->
      <div class="fr-col-12 fr-col-md-6">
        <div
          class="fr-input-group"
          [class.fr-input-group--error]="
            (f.prenom.dirty || submitted) && f.prenom.errors
          "
        >
          <label class="fr-label" for="prenom"> Prénom </label>
          <input
            class="fr-input"
            [class.fr-input--error]="
              (f.prenom.dirty || submitted) && f.prenom.errors
            "
            type="text"
            id="prenom"
            name="prenom"
            appCleanStr
            formControlName="prenom"
            [attr.aria-describedby]="
              (f.prenom.dirty || submitted) && f.prenom.errors
                ? 'prenom-messages'
                : null
            "
            [attr.aria-invalid]="
              (f.prenom.dirty || submitted) && f.prenom.errors ? true : false
            "
            required
          />
          <div
            class="fr-messages-group"
            id="prenom-messages"
            aria-live="polite"
          >
            @if ((f.prenom.dirty || submitted) && f.prenom.errors) {
            <p class="fr-message fr-message--error">
              Veuillez vérifier le prénom
            </p>
            }
          </div>
        </div>
      </div>

      <!-- Email -->
      <div class="fr-col-12">
        <div
          class="fr-input-group"
          [class.fr-input-group--error]="
            (f.email.dirty || submitted) && f.email.errors
          "
        >
          <label class="fr-label" for="email"> Adresse email </label>
          <input
            class="fr-input"
            [class.fr-input--error]="
              (f.email.dirty || submitted) && f.email.errors
            "
            type="email"
            id="email"
            name="email"
            formControlName="email"
            [attr.aria-describedby]="
              (f.email.dirty || submitted) && f.email.errors
                ? 'email-messages'
                : null
            "
            [attr.aria-invalid]="
              (f.email.dirty || submitted) && f.email.errors ? true : false
            "
            required
          />
          <div class="fr-messages-group" id="email-messages" aria-live="polite">
            @if ((f.email.dirty || submitted) && f.email.errors) {
            <p class="fr-message fr-message--error">
              Veuillez vérifier l'adresse email, format attendu :
              nom&#64;domaine.fr
            </p>
            }
          </div>
        </div>
      </div>

      <div class="fr-col-12">
        <div
          class="fr-select-group"
          [class.fr-select-group--error]="submitted && f.role.errors"
        >
          <label class="fr-label" for="role"> Accès </label>
          <select
            class="fr-select"
            [class.fr-select--error]="submitted && f.role.errors"
            id="role"
            name="role"
            formControlName="role"
            [attr.aria-describedby]="
              submitted && f.role.errors ? 'role-messages' : null
            "
            [attr.aria-invalid]="submitted && f.role.errors ? true : false"
            required
          >
            <option [ngValue]="null" disabled hidden>
              Sélectionner un rôle
            </option>
            <option value="admin">Administrateur</option>
            <option value="responsable">Gestionnaire</option>
            <option value="simple">Instructeur</option>
            <option value="facteur">Facteur</option>
            <option value="agent">Agent d'accueil</option>
          </select>
          <div class="fr-messages-group" id="role-messages" aria-live="polite">
            @if (submitted && f.role.errors) {
            <p class="fr-message fr-message--error">Le rôle est obligatoire</p>
            }
          </div>
        </div>
      </div>

      <!-- Fonction -->
      <div class="fr-col-12">
        <app-fonction-selection
          [parentFormGroup]="userForm"
          [fonctionFormControl]="fonctionFormControl"
          [fonctionDetailFormControl]="fonctionDetailFormControl"
          [submitted]="submitted"
          invalidFeedbackText="Le champs fonction est obligatoire"
        />
      </div>
    </div>

    <ng-template #modalFooterTemplate>
      <div class="fr-btns-group fr-btns-group--inline fr-btns-group--right">
        <button
          type="button"
          class="fr-btn fr-btn--secondary"
          (click)="closeModals()"
        >
          Annuler
        </button>
        <button
          type="submit"
          class="fr-btn"
          (click)="submitUser()"
          [disabled]="loading"
          [attr.aria-busy]="loading"
        >
          @if (!loading) { Confirmer l'ajournement } @else { Veuillez
          patienter... }
        </button>
      </div>
    </ng-template>
  </form>
</dsfr-modal>
