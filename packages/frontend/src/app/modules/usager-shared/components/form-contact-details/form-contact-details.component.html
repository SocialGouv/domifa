<ng-container *ngIf="currentUserSubject$ | async as me">
  <form [formGroup]="contactDetailsForm" (ngSubmit)="updateInfos()">
    <div class="fr-grid-row fr-grid-row--gutters">
      @if ( me.structure.sms.enabledByDomifa &&
      me.structure.sms.enabledByStructure ) {
      <div class="fr-col-12 fr-col-md-4">
        <fieldset class="fr-fieldset">
          <legend class="fr-fieldset__legend fr-text--bold">
            Le demandeur souhaite-t-il recevoir des notifications par SMS
            (arrivée d'un courrier, échéance de domiciliation) ?
          </legend>
          <div class="fr-fieldset__content">
            <div class="fr-form-group">
              <div class="fr-radio-group">
                <input
                  type="radio"
                  id="sms_oui"
                  formControlName="contactByPhone"
                  [value]="true"
                />
                <label class="fr-label" for="sms_oui">Oui</label>
              </div>
            </div>
            <div class="fr-form-group">
              <div class="fr-radio-group">
                <input
                  type="radio"
                  id="sms_non"
                  formControlName="contactByPhone"
                  [value]="false"
                />
                <label class="fr-label" for="sms_non">Non</label>
              </div>
            </div>
          </div>
        </fieldset>
      </div>
      }

      <div class="fr-col-12 fr-col-md-4">
        <app-phone-input
          [isRequired]="f.contactByPhone.value === true"
          [isMobileOnly]="true"
          [submitted]="submitted"
          formControlName="telephone"
          [label]="'Numéro de téléphone (mobile uniquement)'"
        ></app-phone-input>
      </div>

      <div class="fr-col-12 fr-col-md-4">
        <div
          class="fr-input-group"
          [ngClass]="{
            'fr-input-group--error':
              (f.email.dirty || submitted) && f.email.errors
          }"
        >
          <label class="fr-label" for="email"> Adresse e-mail </label>
          <p class="fr-hint-text">Format attendu : mail[at]domaine.fr</p>
          <input
            type="email"
            class="fr-input"
            id="email"
            spellcheck="off"
            formControlName="email"
            autocomplete="off"
            name="email"
            [attr.aria-describedby]="
              (f.email.dirty || submitted) && f.email.errors
                ? 'email-errors'
                : null
            "
            [attr.aria-invalid]="
              (f.email.dirty || submitted) && f.email.errors ? true : false
            "
          />
          <div class="fr-messages-group">
            <p class="fr-message fr-message--info">
              Adresse e-mail indiquée sur le Cerfa
            </p>
          </div>
          <div
            *ngIf="(f.email.dirty || submitted) && f.email.errors"
            aria-live="polite"
            class="fr-messages-group"
            id="email-errors"
          >
            <p class="fr-message fr-message--error">
              Veuillez vérifier l'adresse email, format attendu :
              nom&#64;domaine.fr
            </p>
          </div>
        </div>
      </div>
    </div>

    <div class="fr-my-4w">
      <button
        type="submit"
        class="fr-btn"
        [disabled]="loading"
        [attr.aria-busy]="loading"
      >
        @if (!loading) {
        <span>Enregistrer les modifications</span>
        } @else {
        <span>
          <fa-icon
            [icon]="['fas', 'circle-notch']"
            aria-hidden="true"
            animation="spin"
          ></fa-icon>
          Veuillez patienter...
        </span>
        }
      </button>
    </div>
  </form>
</ng-container>
