<form
  *ngIf="entretienForm"
  [formGroup]="entretienForm"
  (ngSubmit)="submitEntretien()"
>
  <h2 class="fr-h2" *ngIf="!editEntretien">Entretien avec le demandeur</h2>

  <app-rgpd-warning></app-rgpd-warning>
  <div class="fr-grid-row">
    <div class="fr-col-12 fr-col-md-12">
      <fieldset class="fr-fieldset">
        <legend class="fr-fieldset__legend">Avez-vous été orienté ?</legend>
        <div class="fr-fieldset__element fr-fieldset__element--inline">
          <div class="fr-radio-group">
            <input
              type="radio"
              id="orientation_oui"
              formControlName="orientation"
              [value]="true"
            />
            <label class="fr-label" for="orientation_oui">Oui</label>
          </div>
        </div>
        <div class="fr-fieldset__element fr-fieldset__element--inline">
          <div class="fr-radio-group">
            <input
              type="radio"
              id="orientation_non"
              formControlName="orientation"
              [value]="false"
            />
            <label class="fr-label" for="orientation_non">Non</label>
          </div>
        </div>

        <div class="fr-col-12" *ngIf="e.orientation.value === true">
          <div class="fr-input-group">
            <label class="fr-label" for="orientationDetail"
              >Par quelle structure ou personne ?</label
            >
            <input
              type="text"
              id="orientationDetail"
              formControlName="orientationDetail"
              class="fr-input"
              maxlength="1000"
            />
          </div>
        </div>
      </fieldset>
    </div>
  </div>

  <hr />

  <fieldset class="fr-fieldset">
    <legend class="fr-fieldset__legend">
      Avez-vous déjà une domiciliation ?
    </legend>
    <div class="fr-fieldset__element">
      <div class="fr-grid-row fr-grid-row--gutters">
        <div class="fr-col-12 fr-col-md-6">
          <div class="fr-radio-group">
            <input
              type="radio"
              id="domiciliation_oui"
              formControlName="domiciliation"
              [value]="true"
            />
            <label class="fr-label" for="domiciliation_oui">Oui</label>
          </div>
        </div>
        <div class="fr-col-12 fr-col-md-6">
          <div class="fr-radio-group">
            <input
              type="radio"
              id="domiciliation_non"
              formControlName="domiciliation"
              [value]="false"
            />
            <label class="fr-label" for="domiciliation_non">Non</label>
          </div>
        </div>
      </div>
    </div>
    <p class="fr-text--sm">
      Une domiciliation existante n'est pas un motif de refus. Néanmoins, il
      faut rechercher pourquoi la personne formule une nouvelle demande et
      l'inviter à choisir quelle domiciliation elle souhaite conserver.
    </p>
  </fieldset>

  <hr />

  <fieldset class="fr-fieldset">
    <legend class="fr-fieldset__legend">
      Quelle est votre situation professionnelle ?
    </legend>
    <div class="fr-fieldset__element">
      <div class="fr-grid-row fr-grid-row--gutters">
        <ng-container
          *ngFor="let situationPro of ENTRETIEN_SITUATION_PRO | keyvalue"
        >
          <div
            class="fr-col-12 fr-col-md-6"
            *ngIf="situationPro.key !== 'AUTRE'"
          >
            <div class="fr-radio-group">
              <input
                type="radio"
                id="{{ situationPro.key }}"
                formControlName="situationPro"
                value="{{ situationPro.key }}"
              />
              <label class="fr-label" for="{{ situationPro.key }}">
                {{ situationPro.value }}
              </label>
            </div>
          </div>
        </ng-container>
        <div class="fr-col-12 fr-col-md-6">
          <div class="fr-radio-group">
            <input
              type="radio"
              id="situationProAutre"
              formControlName="situationPro"
              value="AUTRE"
            />
            <label class="fr-label" for="situationProAutre"
              >Autre situation</label
            >
          </div>
        </div>
      </div>
    </div>
  </fieldset>
  <div *ngIf="e.situationPro.value === 'AUTRE'" class="fr-grid-row">
    <div class="fr-col-12">
      <div class="fr-input-group">
        <label class="fr-label" for="situationProDetail"
          >Précisez la nature de la situation</label
        >
        <input
          type="text"
          id="situationProDetail"
          formControlName="situationProDetail"
          class="fr-input"
        />
      </div>
    </div>
  </div>

  <hr />

  <fieldset class="fr-fieldset">
    <legend class="fr-fieldset__legend">Avez-vous des revenus ?</legend>
    <div class="fr-fieldset__element">
      <div class="fr-grid-row fr-grid-row--gutters">
        <div class="fr-col-12 fr-col-md-6">
          <div class="fr-radio-group">
            <input
              type="radio"
              id="revenus_oui"
              formControlName="revenus"
              [value]="true"
            />
            <label class="fr-label" for="revenus_oui">Oui</label>
          </div>
        </div>
        <div class="fr-col-12 fr-col-md-6">
          <div class="fr-radio-group">
            <input
              type="radio"
              id="revenus_non"
              formControlName="revenus"
              [value]="false"
            />
            <label class="fr-label" for="revenus_non">Non</label>
          </div>
        </div>
      </div>
    </div>
    <div
      *ngIf="e.revenus.value === true"
      class="fr-grid-row fr-grid-row--gutters"
    >
      <div class="fr-col-12">
        <div class="fr-input-group">
          <label class="fr-label" for="revenusDetail">De quelle nature ?</label>
          <textarea
            id="revenusDetail"
            formControlName="revenusDetail"
            class="fr-input"
            maxlength="1000"
          ></textarea>
        </div>
      </div>
    </div>
  </fieldset>

  <hr />

  <fieldset class="fr-fieldset">
    <legend class="fr-fieldset__legend">
      Quel est votre lien avec la commune ? (Uniquement pour les communes, CCAS,
      CIAS)
    </legend>
    <div class="fr-fieldset__element">
      <div class="fr-grid-row fr-grid-row--gutters">
        <ng-container
          *ngFor="let liencommune of ENTRETIEN_LIEN_COMMUNE | keyvalue"
        >
          <div
            class="fr-col-12 fr-col-md-6"
            *ngIf="liencommune.key !== 'AUTRE'"
          >
            <div class="fr-radio-group">
              <input
                type="radio"
                id="{{ liencommune.key }}"
                formControlName="liencommune"
                value="{{ liencommune.key }}"
              />
              <label class="fr-label" for="{{ liencommune.key }}">
                {{ liencommune.value }}
              </label>
            </div>
          </div>
        </ng-container>
        <div class="fr-col-12 fr-col-md-6">
          <div class="fr-radio-group">
            <input
              type="radio"
              id="liencommune_autre"
              formControlName="liencommune"
              value="AUTRE"
            />
            <label class="fr-label" for="liencommune_autre"
              >Autre lien avec la commune</label
            >
          </div>
        </div>
      </div>
    </div>
  </fieldset>
  <div
    *ngIf="e.liencommune.value === 'AUTRE'"
    class="fr-grid-row fr-grid-row--gutters"
  >
    <div class="fr-col-12">
      <div class="fr-input-group">
        <label class="fr-label" for="liencommuneDetail"
          >Précisez lien avec la commune</label
        >
        <input
          type="text"
          id="liencommuneDetail"
          formControlName="liencommuneDetail"
          class="fr-input"
          maxlength="1000"
        />
      </div>
    </div>
  </div>

  <hr />

  <fieldset class="fr-fieldset">
    <legend class="fr-fieldset__legend">
      Quelle est la composition de votre ménage ?
    </legend>
    <div class="fr-fieldset__element">
      <div class="fr-grid-row fr-grid-row--gutters">
        <div
          class="fr-col-12 fr-col-md-6"
          *ngFor="let typeMenage of ENTRETIEN_TYPE_MENAGE | keyvalue"
        >
          <div class="fr-radio-group">
            <input
              type="radio"
              id="{{ typeMenage.key }}"
              formControlName="typeMenage"
              value="{{ typeMenage.key }}"
            />
            <label class="fr-label" for="{{ typeMenage.key }}">
              {{ typeMenage.value }}
            </label>
          </div>
        </div>
      </div>
    </div>
  </fieldset>

  <hr />

  <fieldset class="fr-fieldset">
    <legend class="fr-fieldset__legend">
      Quelle est votre situation résidentielle ?
    </legend>
    <div class="fr-fieldset__element">
      <div class="fr-grid-row fr-grid-row--gutters">
        <ng-container *ngFor="let residence of ENTRETIEN_RESIDENCE | keyvalue">
          <div class="fr-col-12 fr-col-md-6" *ngIf="residence.key !== 'AUTRE'">
            <div class="fr-radio-group">
              <input
                type="radio"
                id="{{ residence.key }}"
                formControlName="residence"
                value="{{ residence.key }}"
              />
              <label class="fr-label" for="{{ residence.key }}">
                {{ residence.value }}
              </label>
            </div>
          </div>
        </ng-container>
        <div class="fr-col-12 fr-col-md-6">
          <div class="fr-radio-group">
            <input
              type="radio"
              id="residenceAutre"
              formControlName="residence"
              value="AUTRE"
            />
            <label class="fr-label" for="residenceAutre"
              >Autre situation résidentielle</label
            >
          </div>
        </div>
      </div>
    </div>
  </fieldset>
  <div
    *ngIf="e.residence.value === 'AUTRE'"
    class="fr-grid-row fr-grid-row--gutters"
  >
    <div class="fr-col-12">
      <div class="fr-input-group">
        <label class="fr-label" for="residenceDetail"
          >Précisez la nature de la situation résidentielle</label
        >
        <input
          type="text"
          id="residenceDetail"
          formControlName="residenceDetail"
          class="fr-input"
          maxlength="1000"
        />
      </div>
    </div>
  </div>

  <hr />

  <fieldset class="fr-fieldset">
    <legend class="fr-fieldset__legend">
      Quelle est la cause de l'instabilité de logement ?
    </legend>
    <div class="fr-fieldset__element">
      <div class="fr-grid-row fr-grid-row--gutters">
        <ng-container
          *ngFor="let cause of ENTRETIEN_CAUSE_INSTABILITE | keyvalue"
        >
          <div class="fr-col-12 fr-col-md-6" *ngIf="cause.key !== 'AUTRE'">
            <div class="fr-radio-group">
              <input
                type="radio"
                id="{{ cause.key }}"
                formControlName="cause"
                value="{{ cause.key }}"
              />
              <label class="fr-label" for="{{ cause.key }}">
                {{ cause.value }}
              </label>
            </div>
          </div>
        </ng-container>
        <div class="fr-col-12 fr-col-md-6">
          <div class="fr-radio-group">
            <input
              type="radio"
              id="causeAutre"
              formControlName="cause"
              value="AUTRE"
            />
            <label class="fr-label" for="causeAutre"
              >Autre cause d'instabilité</label
            >
          </div>
        </div>
      </div>
    </div>
  </fieldset>
  <div
    *ngIf="e.cause.value === 'AUTRE'"
    class="fr-grid-row fr-grid-row--gutters"
  >
    <div class="fr-col-12">
      <div class="fr-input-group">
        <label class="fr-label" for="causeDetail"
          >Précisez la cause de l'instabilité</label
        >
        <input
          type="text"
          id="causeDetail"
          formControlName="causeDetail"
          class="fr-input"
          maxlength="1000"
        />
      </div>
    </div>
  </div>
  <hr />

  <fieldset class="fr-fieldset">
    <legend class="fr-fieldset__legend">
      Quel est le motif principal de demande de domiciliation ?
    </legend>
    <div class="fr-fieldset__element">
      <div class="fr-grid-row fr-grid-row--gutters">
        <ng-container
          *ngFor="let raison of ENTRETIEN_RAISON_DEMANDE | keyvalue"
        >
          <div class="fr-col-12 fr-col-md-6" *ngIf="raison.key !== 'AUTRE'">
            <div class="fr-radio-group">
              <input
                type="radio"
                id="{{ raison.key }}"
                formControlName="raison"
                value="{{ raison.key }}"
              />
              <label class="fr-label" for="{{ raison.key }}">
                {{ raison.value }}
              </label>
            </div>
          </div>
        </ng-container>
        <div class="fr-col-12 fr-col-md-6">
          <div class="fr-radio-group">
            <input
              type="radio"
              id="raisonAutre"
              formControlName="raison"
              value="AUTRE"
            />
            <label class="fr-label" for="raisonAutre">Autre motif</label>
          </div>
        </div>
      </div>
    </div>
  </fieldset>
  <div
    *ngIf="e.raison.value === 'AUTRE'"
    class="fr-grid-row fr-grid-row--gutters"
  >
    <div class="fr-col-12">
      <div class="fr-input-group">
        <label class="fr-label" for="raisonDetail">Précisez le motif</label>
        <input
          type="text"
          id="raisonDetail"
          formControlName="raisonDetail"
          class="fr-input"
          maxlength="1000"
        />
      </div>
    </div>
  </div>
  <hr />

  <fieldset class="fr-fieldset">
    <legend class="fr-fieldset__legend">
      Faites-vous l'objet d'un accompagnement social ?
    </legend>
    <div class="fr-fieldset__element">
      <div class="fr-grid-row fr-grid-row--gutters">
        <div class="fr-col-12 fr-col-md-6">
          <div class="fr-radio-group">
            <input
              type="radio"
              id="accompagnement_oui"
              formControlName="accompagnement"
              [value]="true"
            />
            <label class="fr-label" for="accompagnement_oui">Oui</label>
          </div>
        </div>
        <div class="fr-col-12 fr-col-md-6">
          <div class="fr-radio-group">
            <input
              type="radio"
              id="accompagnement_non"
              formControlName="accompagnement"
              [value]="false"
            />
            <label class="fr-label" for="accompagnement_non">Non</label>
          </div>
        </div>
      </div>
    </div>
  </fieldset>
  <div
    *ngIf="e.accompagnement.value === true"
    class="fr-grid-row fr-grid-row--gutters"
  >
    <div class="fr-col-12">
      <div class="fr-input-group">
        <label class="fr-label" for="accompagnementDetail"
          >Par quelle structure ?</label
        >
        <input
          type="text"
          id="accompagnementDetail"
          formControlName="accompagnementDetail"
          class="fr-input"
        />
      </div>
    </div>
  </div>

  <hr />

  <div class="fr-grid-row fr-grid-row--gutters">
    <div class="fr-col-12">
      <div class="fr-input-group">
        <label class="fr-label" for="rattachement">
          Cette domiciliation est-elle réalisée au titre d'une autre commune ou
          d'un autre arrondissement ? Si oui, complétez le champ ci-dessous
        </label>
        <input
          type="text"
          id="rattachement"
          formControlName="rattachement"
          class="fr-input"
        />
      </div>
    </div>
  </div>

  <hr />

  <div class="fr-grid-row fr-grid-row--gutters">
    <div class="fr-col-12">
      <div class="fr-input-group">
        <label class="fr-label" for="commentaires">Commentaires</label>
        <textarea
          id="commentaires"
          formControlName="commentaires"
          class="fr-input"
          rows="6"
          aria-describedby="commentairesHelp"
          maxlength="2000"
        ></textarea>
        <small id="commentairesHelp" class="fr-hint-text"
          >2000 caractères maximum</small
        >
      </div>
    </div>
  </div>

  <div class="fr-mt-6w fr-mb-6w" style="text-align: center">
    <button
      type="submit"
      *ngIf="editEntretien"
      class="fr-btn fr-btn--primary"
      [disabled]="loading"
      [attr.aria-busy]="loading"
    >
      <span *ngIf="!loading">Enregistrer les modifications</span>
      <span *ngIf="loading">
        <fa-icon
          [icon]="['fas', 'circle-notch']"
          animation="spin"
          aria-hidden="true"
        ></fa-icon>
        Veuillez patienter...
      </span>
    </button>

    <ng-container
      *ngIf="usager.decision.statut === 'INSTRUCTION' && !editEntretien"
    >
      <button
        [disabled]="loading"
        [attr.aria-busy]="loading"
        type="submit"
        class="fr-btn fr-btn--primary fr-mr-2w"
      >
        <span *ngIf="!loading">
          Suivant
          <fa-icon [icon]="['fas', 'angle-right']" aria-hidden="true"></fa-icon>
        </span>
        <span *ngIf="loading">
          <fa-icon
            [icon]="['fas', 'circle-notch']"
            animation="spin"
            aria-hidden="true"
          ></fa-icon>
          Veuillez patienter...
        </span>
      </button>

      <a routerLink="/manage" class="fr-btn fr-btn--secondary">
        Continuer plus tard
        <fa-icon [icon]="['fas', 'angle-right']" aria-hidden="true"></fa-icon>
      </a>
    </ng-container>
  </div>
</form>
