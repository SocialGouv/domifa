<button
  type="button"
  class="fr-btn fr-btn--secondary"
  (click)="openAddNoteInModal()"
>
  Ajouter une note
</button>

<dsfr-modal
  #modal
  [titleModal]="'Nouvelle note concernant ' + usager.nom + ' ' + usager.prenom"
  [isScrollable]="true"
  [size]="'LG'"
>
  <form [formGroup]="addNoteForm" (ngSubmit)="submit()">
    <div
      class="fr-input-group"
      [ngClass]="{
        'fr-input-group--error':
          (f.message.dirty || submitted) && f.message.errors
      }"
    >
      <label class="fr-label" for="message"> Contenu de la note </label>
      <textarea
        class="fr-input"
        formControlName="message"
        id="message"
        maxlength="1000"
        appCleanStr
        aria-describedby="message-hint"
        [attr.aria-invalid]="
          (f.message.dirty || submitted) && f.message.errors ? 'true' : 'false'
        "
        required
        rows="6"
      ></textarea>
      <p id="message-hint" class="fr-hint-text">
        1000 caractères maximum. Caractères interdits : &#36; &#126; &#42; &#60;
        &#62; &#123; &#125;
      </p>
      <p
        *ngIf="(submitted || f.message.dirty) && f.message.errors"
        class="fr-error-text"
        role="alert"
      >
        Veuillez vérifier le contenu de la note saisie. De 1 à 1000 caractères
        maximum. Caractères interdits : &#36; &#126; &#42; &#60; &#62; &#123;
        &#125;
      </p>
    </div>
    <app-rgpd-warning></app-rgpd-warning>

    <div class="fr-btns-group fr-btns-group--inline fr-btns-group--right">
      <button
        type="button"
        class="fr-btn fr-btn--secondary"
        (click)="cancel.emit()"
      >
        Annuler
      </button>

      <button
        type="submit"
        class="fr-btn"
        [disabled]="loading"
        [attr.aria-busy]="loading"
      >
        <span *ngIf="!loading">Enregistrer la note</span>
        <span *ngIf="loading">
          <span
            class="fr-spinner"
            role="status"
            aria-label="Enregistrement en cours"
          >
            <span class="fr-sr-only">Patientez...</span>
          </span>
          Veuillez patienter...
        </span>
      </button>
    </div>
  </form>
</dsfr-modal>
