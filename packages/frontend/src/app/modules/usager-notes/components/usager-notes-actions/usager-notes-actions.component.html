<dsfrx-dropdownmenu
  [labelMenu]="'Actions'"
  class="fr-icon-settings-line fr-btn--icon-left"
>
  <ng-template #contentTemplate>
    @if (!note.archived) {
    <dsfrx-dropdownmenu-item (selectItem)="pinNote(note)">
      <div>
        <span class="fr-icon-pushpin-line" aria-hidden="true"></span>
        {{ note.pinned ? "Désépingler" : "Épingler" }} la note
      </div>
    </dsfrx-dropdownmenu-item>
    }

    <dsfrx-dropdownmenu-item (selectItem)="openActionModal('ARCHIVE')">
      <div>
        <span
          [class]="
            note.archived
              ? 'fr-icon-inbox-unarchive-line'
              : 'fr-icon-inbox-archive-line'
          "
          aria-hidden="true"
        ></span>
        {{ note.archived ? "Rétablir" : "Archiver" }} la note
      </div>
    </dsfrx-dropdownmenu-item>

    <dsfrx-dropdownmenu-item
      class="fr-menu__link--danger"
      (selectItem)="openActionModal('DELETE')"
    >
      <div>
        <span class="fr-icon-delete-line" aria-hidden="true"></span>
        Supprimer la note
      </div>
    </dsfrx-dropdownmenu-item>
  </ng-template>
</dsfrx-dropdownmenu>

<ng-template #deleteOrArchiveNoteModal let-modal>
  <div class="fr-modal__header">
    <button
      class="fr-btn--close"
      type="button"
      (click)="modal.dismiss()"
      aria-label="Fermer la modale"
    >
      <span class="fr-icon-close-line" aria-hidden="true"></span>
    </button>
  </div>

  <div class="fr-modal__body">
    <h1 class="fr-modal__title" id="modal-title">
      @switch (choosenAction) { @case ('DELETE') {
      <span>
        Supprimer une note du dossier de {{ usager.nom }} {{ usager.prenom }}
      </span>
      } @case ('ARCHIVE') { @if (!note.archived) {
      <span> Archiver une note du dossier de {{ usager | fullName }} </span>
      } @else {
      <span> Désarchiver une note du dossier de {{ usager | fullName }} </span>
      } } }
    </h1>

    @if (choosenAction === 'DELETE') {
    <div class="fr-alert fr-alert--info">
      <p class="fr-alert__title">Attention</p>
      <p class="fr-alert__desc">
        Êtes-vous sûr de vouloir supprimer cette note ?
        <strong>Cette action est définitive</strong>, vous ne pourrez plus
        retrouver la note dans l'historique !
      </p>
    </div>
    } @if (choosenAction === 'ARCHIVE' && !note.archived) {
    <p>
      Une note archivée n'apparait plus dans la section "Vue d'ensemble" de la
      fiche. Vous pourrez toujours la consulter dans la page historique.
    </p>
    } @if (choosenAction === 'ARCHIVE' && note.archived) {
    <p>
      Cette note est déjà archivée. Vous êtes sur le point de la retirer des
      archives. Elle sera de nouveau visible dans la section "Vue d'ensemble" du
      dossier.
    </p>
    }
  </div>

  <div class="fr-modal__footer">
    <ul class="fr-btns-group fr-btns-group--right fr-btns-group--inline">
      <li>
        <button
          type="button"
          class="fr-btn fr-btn--secondary"
          (click)="cancelArchiveOrDelete()"
          [disabled]="loading"
        >
          Annuler
        </button>
      </li>
      <li>
        <button
          type="submit"
          [class.fr-btn--danger]="choosenAction === 'DELETE'"
          class="fr-btn"
          (click)="confirmAction()"
          [disabled]="loading"
          [attr.aria-busy]="loading"
        >
          @if (!loading) {
          <span>Confirmer</span>
          } @else {
          <span>
            <span
              class="fr-icon-refresh-line fr-icon--spin"
              aria-hidden="true"
            ></span>
            Veuillez patienter...
          </span>
          }
        </button>
      </li>
    </ul>
  </div>
</ng-template>
