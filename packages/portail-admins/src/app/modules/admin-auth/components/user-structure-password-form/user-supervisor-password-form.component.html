<div
  class="fr-background-alt--grey h-100 d-flex flex-column ap-2"
  *ngIf="parentFormGroup"
>
  <div class="col-md-12 col-12 fr-input-group required">
    <div class="fr-password" id="password-group">
      <label class="fr-password__label fr-label" for="password">
        Mot de passe
      </label>
      <div class="fr-input-wrap">
        <input
          (ngModelChange)="setPassword($event)"
          [(ngModel)]="password"
          name="password"
          [type]="!hidePassword ? 'text' : 'password'"
          class="fr-password__input fr-input"
          id="password"
          aria-describedby="invalid-password"
          [attr.aria-invalid]="
            (submitted || parentFormGroup.controls.password.dirty) &&
            parentFormGroup.controls.password.errors
              ? true
              : false
          "
          autocomplete="new-password"
          required
        />
      </div>
      <div class="fr-messages-group" id="invalid-password" aria-live="polite">
        <p class="fr-message" id="password-min-number-rule">
          Votre mot de passe doit contenir :
        </p>
        <p
          [ngClass]="
            parentFormGroup.controls.password?.errors?.required ||
            parentFormGroup.controls.password?.errors?.hasNumber
              ? 'fr-message--error'
              : 'fr-message--valid'
          "
          class="fr-message"
          id="password-hasNumber-rule"
        >
          Au moins 1 chiffre
        </p>
        <p
          [ngClass]="
            parentFormGroup.controls.password?.errors?.required ||
            parentFormGroup.controls.password?.errors?.hasCapitalCase
              ? 'fr-message--error'
              : 'fr-message--valid'
          "
          class="fr-message"
          id="password-uppecase-rule"
        >
          Au moins une lettre en majuscule
        </p>
        <p
          [ngClass]="
            parentFormGroup.controls.password?.errors?.required ||
            parentFormGroup.controls.password?.errors?.hasLowerCase
              ? 'fr-message--error'
              : 'fr-message--valid'
          "
          class="fr-message"
          id="password-lowercase-rule"
        >
          Au moins une lettre en minuscule
        </p>
        <p
          [ngClass]="
            parentFormGroup.controls.password?.errors?.required ||
            parentFormGroup.controls.password?.errors?.hasSpecialCharacter
              ? 'fr-message--error'
              : 'fr-message--valid'
          "
          class="fr-message"
          id="password-specialchar-rule"
        >
          Au moins un caractère spécial:
          &#64;[]^_!"#$%&amp;&apos;()*+,\-./:;&lbrace;&rbrace;&lt;&gt;=|~?
        </p>
        <p
          [ngClass]="
            parentFormGroup.controls.password?.errors?.required ||
            parentFormGroup.controls.password?.errors?.minlength ||
            parentFormGroup.controls.password?.errors?.maxlength
              ? 'fr-message--error'
              : 'fr-message--valid'
          "
          class="fr-message"
          id="password-min-length"
        >
          entre 12 et 150 caractères
        </p>
      </div>
      <div
        class="fr-password__checkbox fr-checkbox-group fr-checkbox-group--sm"
      >
        <input
          id="show-password"
          type="checkbox"
          role="switch"
          [attr.aria-checked]="!hidePasswordConfirmation"
          [attr.aria-label]="
            (hidePasswordConfirmation ? 'Voir' : 'Masquer') +
            ' la confirmation du mot de passe'
          "
          (click)="togglePasswordConfirmation()"
        />
        <label class="fr--password__checkbox fr-label" for="show-password">
          Afficher
        </label>
      </div>
    </div>
  </div>
  <div class="col-md-12 col-12 fr-input-group required">
    <div class="fr-password" id="password-group">
      <label
        class="fr-password__label fr-label"
        for="passwordConfirmationInput"
      >
        Confirmer votre mot de passe
      </label>
      <div class="fr-input-wrap">
        <input
          class="fr-password__input fr-input"
          [type]="!hidePasswordConfirmation ? 'text' : 'password'"
          [ngClass]="{
            'is-invalid':
              (parentFormGroup.controls.passwordConfirmation.dirty ||
                submitted) &&
              (parentFormGroup.controls.passwordConfirmation.errors ||
                parentFormGroup?.errors?.noPassswordMatch),
            'is-valid':
              parentFormGroup.controls.passwordConfirmation.dirty &&
              !parentFormGroup.controls.passwordConfirmation.errors &&
              !parentFormGroup?.errors?.noPassswordMatch
          }"
          aria-describedby="invalid-confirmation-password"
          [attr.aria-invalid]="
            (parentFormGroup.controls.passwordConfirmation.dirty ||
              submitted) &&
            (parentFormGroup.controls.passwordConfirmation.errors ||
              parentFormGroup?.errors?.noPassswordMatch)
              ? true
              : false
          "
          id="passwordConfirmationInput"
          autocomplete="new-password"
          (ngModelChange)="setPasswordConfirm($event)"
          [(ngModel)]="passwordConfirmation"
          name="passwordConfirmation"
          required
        />
      </div>
      <div
        class="fr-messages-group"
        id="invalid-confirmation-password"
        aria-live="polite"
      >
        <p class="fr-message" id="password-confirm-rule">
          La confirmation de mot de passe doit :
        </p>
        <p
          [ngClass]="
            parentFormGroup.controls.passwordConfirmation?.errors?.required
              ? 'fr-message--error'
              : 'fr-message--valid'
          "
          class="fr-message"
        >
          contenir entre 12 et 150 caractères
        </p>
        <p
          [ngClass]="
            parentFormGroup.controls.passwordConfirmation?.errors?.required ||
            parentFormGroup?.errors?.noPassswordMatch
              ? 'fr-message--error'
              : 'fr-message--valid'
          "
          class="fr-message"
          id="password-confirm-match-rule"
        >
          être identique au mot de passe
        </p>
      </div>
      <div
        class="fr-password__checkbox fr-checkbox-group fr-checkbox-group--sm"
      >
        <input
          aria-label="Afficher le mot de passe"
          id="passwordConfirm-show"
          type="checkbox"
          role="switch"
          [attr.aria-checked]="!hidePassword"
          (click)="togglePassword()"
        />
        <label
          class="fr--password__checkbox fr-label"
          for="passwordConfirm-show"
        >
          Afficher
        </label>
      </div>
    </div>
  </div>
</div>
