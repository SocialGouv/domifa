<h2>Utilisateurs enregistr√©s: {{ users.length }} utilisateurs</h2>
<div class="table-responsive">
  <table class="table" [attr.aria-rowcount]="users.length">
    <caption class="visually-hidden">
      Liste des utilisateurs enregistr√©s
    </caption>
    <thead>
      <tr>
        <th scope="col">
          <app-table-head-sort
            sortKey="id"
            [(sortValue)]="sortValue"
            [(currentKey)]="currentKey"
            columnName="ID"
          >
          </app-table-head-sort>
        </th>
        <th scope="col">
          <app-table-head-sort
            sortKey="nom"
            [(sortValue)]="sortValue"
            [(currentKey)]="currentKey"
            columnName="Nom pr√©nom"
          >
          </app-table-head-sort>
        </th>
        <th scope="col">
          <app-table-head-sort
            sortKey="fonction"
            [(sortValue)]="sortValue"
            [(currentKey)]="currentKey"
            columnName="Fonction"
          >
          </app-table-head-sort>
        </th>
        <th scope="col">
          <app-table-head-sort
            sortKey="email"
            [(sortValue)]="sortValue"
            [(currentKey)]="currentKey"
            columnName="Email"
          >
          </app-table-head-sort>
        </th>
        <th scope="col">
          <app-table-head-sort
            sortKey="createdAt"
            [(sortValue)]="sortValue"
            [(currentKey)]="currentKey"
            columnName="Date d'inscription"
          >
          </app-table-head-sort>
        </th>
        <th scope="col">
          <app-table-head-sort
            sortKey="verified"
            [(sortValue)]="sortValue"
            [(currentKey)]="currentKey"
            columnName="Statut"
          >
          </app-table-head-sort>
        </th>
        <th scope="col">
          <app-table-head-sort
            sortKey="lastLogin"
            [(sortValue)]="sortValue"
            [(currentKey)]="currentKey"
            columnName="Derni√®re connexion"
          >
          </app-table-head-sort>
        </th>
        <th scope="col">
          <app-table-head-sort
            sortKey="role"
            [(sortValue)]="sortValue"
            [(currentKey)]="currentKey"
            columnName="R√¥le"
          >
          </app-table-head-sort>
        </th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr
        *ngFor="
          let user of users | sortArray : currentKey : sortValue;
          let i = index
        "
        [attr.aria-rowindex]="i + 1"
      >
        <td class="fw-bold">{{ user.id }}</td>
        <td class="fw-bold">{{ user.nom }} {{ user.prenom }}</td>
        <td class="fw-bold">
          {{ _USER_FONCTION_LABELS[user.fonction] }}
          <ng-container
            *ngIf="user.fonction === USER_FONCTION.AUTRE && user.fonctionDetail"
          >
            : {{ user.fonctionDetail }}
          </ng-container>
        </td>
        <td>{{ user.email }}</td>
        <td>{{ user.createdAt | date : "d MMMM y" }}</td>
        <td>
          <p *ngIf="user.verified">‚úÖ Compte actif</p>
          <p *ngIf="!user.verified">‚ùå Compte non v√©rifi√©</p>
        </td>
        <td>
          <ng-container *ngIf="user.lastLogin">
            <p>
              {{ user.lastLogin | date : "dd/MM/yyyy" }}
              <b *ngIf="user.lastLogin < twoMonthsAgo">
                <br />‚ùå Inactif depuis plus de 2 mois<br />
              </b>
            </p>
          </ng-container>
          <p class="fw-bold" *ngIf="!user.lastLogin">
            ‚ùå Compte jamais utilis√©
          </p>
        </td>
        <td>
          {{ USER_ROLES_LABELS[user.role] }}
        </td>
        <td>
          <a
            target="_blank"
            class="btn btn-outline-primary"
            [attr.href]="
              frontendUrl +
              'users/reset-password/' +
              user.id +
              '/' +
              user?.temporaryTokens?.token
            "
            *ngIf="user?.temporaryTokens?.type === 'reset-password'"
          >
            üîó Lien</a
          >
          <button
            class="btn btn-outline-primary m-1"
            (click)="
              openConfirmationModal(user, MODAL_ACTION.REINIT_USER_PASSWORD)
            "
            type="button"
          >
            R√©initialiser mot de passe
          </button>
          <button
            *ngIf="user.role !== 'admin'"
            (click)="openConfirmationModal(user, MODAL_ACTION.PROMOTE_USER)"
            class="btn btn-outline-primary mr-2"
            type="button"
          >
            <fa-icon
              class="ms-2"
              aria-hidden="true"
              [icon]="personArrowUp"
            ></fa-icon>
            Promouvoir
          </button>
        </td>
      </tr>
    </tbody>
  </table>

  <ng-template #confirmPasswordReinit let-modal>
    <div class="modal-header">
      <h4 class="modal-title">Confirmation</h4>
      <button
        type="button"
        class="btn-close"
        aria-label="Close"
        (click)="modal.dismiss()"
      ></button>
    </div>
    <div class="modal-body">
      <p>
        √ätes-vous s√ªr de vouloir {{ confirmModalContext.actionText }}:
        <span class="fw-bold">
          {{ userForConfirmModal.email }}
        </span>
        ?
      </p>
    </div>
    <div class="modal-footer">
      <button
        type="button"
        class="btn btn-lg btn-outline-dark"
        (click)="confirmModalContext = null; modal.dismiss()"
      >
        Annuler
      </button>
      <button
        type="button"
        class="btn btn-primary"
        (click)="confirmModalContext.action(userForConfirmModal)"
      >
        Confirmer
      </button>
    </div>
  </ng-template>
</div>
