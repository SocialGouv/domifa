# Tests

## Tests backend en local avec docker

### Tests unitaires backend

Exécution des tests unitaires du backend en local avec docker

__Pré-requis__: mise en  place de l'environnement de dev local: [./00.run-local-env.md](./00.run-local-env.md)

Lancer l'environnement de dev:

```bash
# or build + recreate
APP_DIR=$(pwd) docker-compose -f ./docker-compose.local.yml up --build --force-recreate
```

Restaurer les bases de test:

```bash
./_scripts/db/restore-postgres-tests-docker.sh
./_scripts/db/restore-mongo-tests-docker.sh
```

```bash
# entrer dans le container docker du backend
docker exec -it domifa-backend-dev bash
# exécuter la dernière migration:
yarn db:dev:migrate-up
# exécuter les tests unitaires
yarn test
```

### Tests e2e backend

Restaurer les bases de test:

```bash
./_scripts/db/restore-postgres-tests-docker.sh
./_scripts/db/restore-mongo-tests-docker.sh
```

Démarrer le backend de test (les éventuelles migrations vont être appliquées au démarrage du serveur):

```bash
# entrer dans le container docker du backend
docker exec -it domifa-backend-dev bash
# démarrer le backend (branché sur les bases de test)
yarn start:tests-local
```

Démarrer le frontend:

```bash
# entrer dans le container docker du frontend
docker exec -it domifa-frontend-dev bash
# démarrer le frontend
npm start
```

Exécuter les tests

```bash
cd optional/e2e/runners/puppeteer
yarn test:debug
```
