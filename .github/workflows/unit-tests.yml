
    - name: Set up Node.js v14
      uses: actions/setup-node@v2
      with:
        node-version: '14'

    - name: Set up Yarn cache
      uses: c-hive/gha-yarn-cache@v1

    - name: Install front-end dependencies
      run: yarn workspace @domifa/frontend install --frozen-lockfile --prefer-offline

    - name: Run front-end tests
      run: yarn workspace @domifa/frontend test --coverage --detectOpenHandles --forceExit

    - name: Archive code coverage
      uses: actions/upload-artifact@v2
      with:
        name: frontend-coverage
        path: packages/frontend/coverage

  codecov:
    name: Publish code coverage
    runs-on: ubuntu-18.04
    needs: [backend, frontend]
    steps:

      - name: Checkout
        uses: actions/checkout@v2
        with:
          ref: ${{ github.event.pull_request.head.sha || github.sha }}

      - name: Download backend coverage
        uses: actions/download-artifact@v2
        with:
          name: backend-coverage
          path: packages/backend/coverage

      - name: Download front-end coverage
        uses: actions/download-artifact@v2
        with:
          name: frontend-coverage
          path: packages/frontend/coverage

      - name: Publish backend code coverage
        uses: codecov/codecov-action@v1
        with:
          fail_ci_if_error: true
          token: ${{ secrets.CODECOV_TOKEN }}
          directory: packages/backend/coverage

      - name: Publish front-end code coverage
        uses: codecov/codecov-action@v1
        with:
          fail_ci_if_error: true
          token: ${{ secrets.CODECOV_TOKEN }}
          directory: packages/frontend/coverage
